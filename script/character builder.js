"use strict";var characterInfo=null,keptPressed=!1,waitForCallback=!1,clockList=[],FUDB={},data={};const domain="https://com.studiosplinters.fabulaultimabeyond/",fallbackImgB64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAABESAAAREgEAwpvaAAACCklEQVQokbWSO2hUURiE5//vuY/NzVNXYohuCCoJKVSMIIqNYrqIkEJIo5WKjYJgIYjGQstUgihiaSpBCIKNEFFQEDEGNObhc03MWza7yZ6995zzWwSCYJXC6QZmmvmGRAQbEW8oDUABSEQcwIAABDCgiCoQASKQMykrvwLxQQSoca2vmjIgDeIYNEu0VeiUCvrJVAn64EfPHuLoyT64OfZ2WKeU8kbCegADupwLMidIlsTtJBoW3pQm2535/nMyZ11rGA+xd1i0ipUHB+coDtVmpkcgD0zixCCFL8ligzfHSEJbbYRbPcWNQO71Mr9xtRbzJVOTuCwAEL2z3gdbGuzD8kTpyY3Pec3vbb32lBNeHJpcTYMjz3k1cTURj1zugJXKyy+l2jA+fn5h8MyWrnNteXn84tu2thYlItMTY9pI2L67d1/D2UNZJgqY0uWS0WVUZ6ua6ry40Vspu9mZSHKqktrEis/m1aWObMZbG9tZ66bGNbPhrrilmfw4XZ12C/nI28++4kxgHEFg1+nEvhdWLTVm08APKNMMUF2NMaEuVjSnIoXfb9N0dDT/62+cV3o6v858ajp97f7H9u6bDy723ysWx77Oz9NUodB76+7Ej9ko8IfvXK/NROu1pyOjF24PALSidfeBPcf27uo52EkiIiLGusJKOVtX/e95imXNRHEUrln672/9A3Ga9XsyeQGMAAAAAElFTkSuQmCC",systemData={svg:{bars:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>',bolt:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"/></svg>',coins:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M0 405.3V448c0 35.3 86 64 192 64s192-28.7 192-64v-42.7C342.7 434.4 267.2 448 192 448S41.3 434.4 0 405.3zM320 128c106 0 192-28.7 192-64S426 0 320 0 128 28.7 128 64s86 64 192 64zM0 300.4V352c0 35.3 86 64 192 64s192-28.7 192-64v-51.6c-41.3 34-116.9 51.6-192 51.6S41.3 334.4 0 300.4zm416 11c57.3-11.1 96-31.7 96-55.4v-42.7c-23.2 16.4-57.3 27.6-96 34.5v63.6zM192 160C86 160 0 195.8 0 240s86 80 192 80 192-35.8 192-80-86-80-192-80zm219.3 56.3c60-10.8 100.7-32 100.7-56.3v-42.7c-35.5 25.1-96.5 38.6-160.7 41.8 29.5 14.3 51.2 33.5 60 57.2z"/></svg>',bone:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M598.88 244.56c25.2-12.6 41.12-38.36 41.12-66.53v-7.64C640 129.3 606.7 96 565.61 96c-32.02 0-60.44 20.49-70.57 50.86-7.68 23.03-11.6 45.14-38.11 45.14H183.06c-27.38 0-31.58-25.54-38.11-45.14C134.83 116.49 106.4 96 74.39 96 33.3 96 0 129.3 0 170.39v7.64c0 28.17 15.92 53.93 41.12 66.53 9.43 4.71 9.43 18.17 0 22.88C15.92 280.04 0 305.8 0 333.97v7.64C0 382.7 33.3 416 74.38 416c32.02 0 60.44-20.49 70.57-50.86 7.68-23.03 11.6-45.14 38.11-45.14h273.87c27.38 0 31.58 25.54 38.11 45.14C505.17 395.51 533.6 416 565.61 416c41.08 0 74.38-33.3 74.38-74.39v-7.64c0-28.18-15.92-53.93-41.12-66.53-9.42-4.71-9.42-18.17.01-22.88z"/></svg>',book:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"/></svg>',backspace:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M576 64H205.26A63.97 63.97 0 0 0 160 82.75L9.37 233.37c-12.5 12.5-12.5 32.76 0 45.25L160 429.25c12 12 28.28 18.75 45.25 18.75H576c35.35 0 64-28.65 64-64V128c0-35.35-28.65-64-64-64zm-84.69 254.06c6.25 6.25 6.25 16.38 0 22.63l-22.62 22.62c-6.25 6.25-16.38 6.25-22.63 0L384 301.25l-62.06 62.06c-6.25 6.25-16.38 6.25-22.63 0l-22.62-22.62c-6.25-6.25-6.25-16.38 0-22.63L338.75 256l-62.06-62.06c-6.25-6.25-6.25-16.38 0-22.63l22.62-22.62c6.25-6.25 16.38-6.25 22.63 0L384 210.75l62.06-62.06c6.25-6.25 16.38-6.25 22.63 0l22.62 22.62c6.25 6.25 6.25 16.38 0 22.63L429.25 256l62.06 62.06z"/></svg>',"angle-right":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"/></svg>',times:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>',box:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M509.5 184.6L458.9 32.8C452.4 13.2 434.1 0 413.4 0H272v192h238.7c-.4-2.5-.4-5-1.2-7.4zM240 0H98.6c-20.7 0-39 13.2-45.5 32.8L2.5 184.6c-.8 2.4-.8 4.9-1.2 7.4H240V0zM0 224v240c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V224H0z"/></svg>',"book-open":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"/></svg>',"shield-alt":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"/></svg>',brain:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M208 0c-29.9 0-54.7 20.5-61.8 48.2-.8 0-1.4-.2-2.2-.2-35.3 0-64 28.7-64 64 0 4.8.6 9.5 1.7 14C52.5 138 32 166.6 32 200c0 12.6 3.2 24.3 8.3 34.9C16.3 248.7 0 274.3 0 304c0 33.3 20.4 61.9 49.4 73.9-.9 4.6-1.4 9.3-1.4 14.1 0 39.8 32.2 72 72 72 4.1 0 8.1-.5 12-1.2 9.6 28.5 36.2 49.2 68 49.2 39.8 0 72-32.2 72-72V64c0-35.3-28.7-64-64-64zm368 304c0-29.7-16.3-55.3-40.3-69.1 5.2-10.6 8.3-22.3 8.3-34.9 0-33.4-20.5-62-49.7-74 1-4.5 1.7-9.2 1.7-14 0-35.3-28.7-64-64-64-.8 0-1.5.2-2.2.2C422.7 20.5 397.9 0 368 0c-35.3 0-64 28.6-64 64v376c0 39.8 32.2 72 72 72 31.8 0 58.4-20.7 68-49.2 3.9.7 7.9 1.2 12 1.2 39.8 0 72-32.2 72-72 0-4.8-.5-9.5-1.4-14.1 29-12 49.4-40.6 49.4-73.9z"/></svg>',"chevron-up":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg>',"chevron-down":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg>',"chevron-left":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"/></svg>',"chevron-right":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>',briefcase:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 336c0 8.84-7.16 16-16 16h-96c-8.84 0-16-7.16-16-16v-48H0v144c0 25.6 22.4 48 48 48h416c25.6 0 48-22.4 48-48V288H320v48zm144-208h-80V80c0-25.6-22.4-48-48-48H176c-25.6 0-48 22.4-48 48v48H48c-25.6 0-48 22.4-48 48v80h512v-80c0-25.6-22.4-48-48-48zm-144 0H192V96h128v32z"/></svg>',check:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"/></svg>',heartbeat:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320.2 243.8l-49.7 99.4c-6 12.1-23.4 11.7-28.9-.6l-56.9-126.3-30 71.7H60.6l182.5 186.5c7.1 7.3 18.6 7.3 25.7 0L451.4 288H342.3l-22.1-44.2zM473.7 73.9l-2.4-2.5c-51.5-52.6-135.8-52.6-187.4 0L256 100l-27.9-28.5c-51.5-52.7-135.9-52.7-187.4 0l-2.4 2.4C-10.4 123.7-12.5 203 31 256h102.4l35.9-86.2c5.4-12.9 23.6-13.2 29.4-.4l58.2 129.3 49-97.9c5.9-11.8 22.7-11.8 28.6 0l27.6 55.2H481c43.5-53 41.4-132.3-7.3-182.1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"/></svg>',running:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 416 512"><path d="M272 96c26.51 0 48-21.49 48-48S298.51 0 272 0s-48 21.49-48 48 21.49 48 48 48zM113.69 317.47l-14.8 34.52H32c-17.67 0-32 14.33-32 32s14.33 32 32 32h77.45c19.25 0 36.58-11.44 44.11-29.09l8.79-20.52-10.67-6.3c-17.32-10.23-30.06-25.37-37.99-42.61zM384 223.99h-44.03l-26.06-53.25c-12.5-25.55-35.45-44.23-61.78-50.94l-71.08-21.14c-28.3-6.8-57.77-.55-80.84 17.14l-39.67 30.41c-14.03 10.75-16.69 30.83-5.92 44.86s30.84 16.66 44.86 5.92l39.69-30.41c7.67-5.89 17.44-8 25.27-6.14l14.7 4.37-37.46 87.39c-12.62 29.48-1.31 64.01 26.3 80.31l84.98 50.17-27.47 87.73c-5.28 16.86 4.11 34.81 20.97 40.09 3.19 1 6.41 1.48 9.58 1.48 13.61 0 26.23-8.77 30.52-22.45l31.64-101.06c5.91-20.77-2.89-43.08-21.64-54.39l-61.24-36.14 31.31-78.28 20.27 41.43c8 16.34 24.92 26.89 43.11 26.89H384c17.67 0 32-14.33 32-32s-14.33-31.99-32-31.99z"/></svg>',archive:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg>',pen:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M109.46 244.04l134.58-134.56-44.12-44.12-61.68 61.68a7.919 7.919 0 0 1-11.21 0l-11.21-11.21c-3.1-3.1-3.1-8.12 0-11.21l61.68-61.68-33.64-33.65C131.47-3.1 111.39-3.1 99 9.29L9.29 99c-12.38 12.39-12.39 32.47 0 44.86l100.17 100.18zm388.47-116.8c18.76-18.76 18.75-49.17 0-67.93l-45.25-45.25c-18.76-18.76-49.18-18.76-67.95 0l-46.02 46.01 113.2 113.2 46.02-46.03zM316.08 82.71l-297 296.96L.32 487.11c-2.53 14.49 10.09 27.11 24.59 24.56l107.45-18.84L429.28 195.9 316.08 82.71zm186.63 285.43l-33.64-33.64-61.68 61.68c-3.1 3.1-8.12 3.1-11.21 0l-11.21-11.21c-3.09-3.1-3.09-8.12 0-11.21l61.68-61.68-44.14-44.14L267.93 402.5l100.21 100.2c12.39 12.39 32.47 12.39 44.86 0l89.71-89.7c12.39-12.39 12.39-32.47 0-44.86z"/></svg>',comment:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>',"paper-plane":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"/></svg>',dice:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M592 192H473.26c12.69 29.59 7.12 65.2-17 89.32L320 417.58V464c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48V240c0-26.51-21.49-48-48-48zM480 376c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm-46.37-186.7L258.7 14.37c-19.16-19.16-50.23-19.16-69.39 0L14.37 189.3c-19.16 19.16-19.16 50.23 0 69.39L189.3 433.63c19.16 19.16 50.23 19.16 69.39 0L433.63 258.7c19.16-19.17 19.16-50.24 0-69.4zM96 248c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm128 128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm0-128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm0-128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24zm128 128c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"/></svg>',share:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"/></svg>',users:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"/></svg>',clock:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"/></svg>',copy:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"/></svg>'},unicode:{fisico:"⚔",aria:"🌬",fulmine:"⚡",ombra:"🕳",terra:"⛰",fuoco:"🔥",ghiaccio:"🧊",luce:"🌣",veleno:"☠",mischia:"⚔",distanza:"🏹",punto:"?"}},defaultData={id:"Default",maxLv:"10",maxClasses:"3",editorTags:{OGGETTO:{RARITA:{label:"Rarita'",tag:"select",values:["BASE","RARA"]},NOME:{label:"Nome",tag:"input",inputType:"text"},CATEGORIA:{label:"Categoria",tag:"select",values:["Da Rissa","Da Lancio","Arcana","Arco","Flagello","Da Fuoco","Lancia","Pesante","Pugnale","Spada","Armatura","Scudo","Accessorio"]},MARZIALE:{label:"E' marziale",tag:"select",values:["","M"]},COSTO:{label:"Costo in zenit",tag:"input",inputType:"number"},PRECISIONE:{label:"Tiro di Precisione",tag:"input",inputType:"text"},DANNO:{label:"Formula Danno",tag:"input",inputType:"text"},TIPO_DANNO:{label:"Tipo Danno",tag:"input",inputType:"text"},MANI:{label:"Mani Richieste",tag:"select",values:["Una","Due","Sec","Corpo"]},RAGGIO:{label:"Raggio",tag:"select",values:["Mischia","Distanza"]},QUALITA:{label:"Qualita' Oggetto",tag:"textarea"},MOD_PV:{label:"Mod. Punti Vita",tag:"input",inputType:"number"},MOD_PM:{label:"Mod. Punti Mente",tag:"input",inputType:"number"},MOD_PI:{label:"Mod. Punti Inventario",tag:"input",inputType:"number"},MOD_INIZ:{label:"Mod. Iniziativa",tag:"input",inputType:"number"},MOD_DIF:{label:"Mod. Difesa",tag:"input",inputType:"number"},MOD_DIFM:{label:"Mod. Difesa Magica",tag:"input",inputType:"number"},TIPO_DIF:{label:"Tipo Mod. Difesa",tag:"select",values:["BASE","MOD"]},TIPO_DIF_MAG:{label:"Tipo Mod. Dif. Magica",tag:"select",values:["BASE","MOD"]},MAX_AB_OGGETTO:{label:"Livello Massimo Abilita' Oggetto",tag:"input",inputType:"number"},AB_OGGETTO:{label:"Abilita' conferite",tag:"list",values:"abilities"}},ABILITA:{TIPO:{label:"Tipo Abilita'",tag:"select",values:["Abilita'","Eroica","Incantesimo"]},SUBTIPO:{label:"Indica la dimensione relativa per abilita' condizionali (come gli incantesimi)",tag:"input",inputType:"number"},MAX_LA:{label:"Massimo Livello Abilita'",tag:"input",inputType:"number"},CLASSE:{label:"Classe",tag:"select",values:["Arcanista","Artefice","Canaglia","Chimerista","Elementalista","Entropista","Furia","Guardiano","Lama Oscura","Maestro d'Armi","Oratore","Sapiente","Spiritista","Tiratore","Viandante"]},NOME:{label:"Nome Abilita'",tag:"input",inputType:"text"},OFFENSIVO:{label:"Mettere 'x' se � un incantesimo offensivo",tag:"select",values:["","x"]},COSTO:{label:"Costo Abilita'",tag:"input",inputType:"text"},BERSAGLIO:{label:"Bersaglio",tag:"input",inputType:"text"},DURATA:{label:"Durata",tag:"input",inputType:"text"},REQUISITI:{label:"Abilita' Requisito",tag:"input",inputType:"text"},TESTO:{label:"Testo Abilita'",tag:"textarea"},MOD_PV:{label:"Mod. Punti Vita",tag:"input",inputType:"number"},MOD_PM:{label:"Mod. Punti Mente",tag:"input",inputType:"number"},MOD_PI:{label:"Mod. Punti Inventario",tag:"input",inputType:"number"},MOD_INIZ:{label:"Mod. Iniziativa",tag:"input",inputType:"number"},MOD_DIF:{label:"Mod. Difesa",tag:"input",inputType:"number"},MOD_DIFM:{label:"Mod. Difesa Magica",tag:"input",inputType:"number"},COMP_MIS:{label:"Fornisce competenza in armi da mischia marziali?",tag:"select",values:["0","1"]},COMP_DIS:{label:"Fornisce competenza in armi a distanza marziali?",tag:"select",values:["0","1"]},COMP_SCU:{label:"Fornisce competenza in scudi marziali?",tag:"select",values:["0","1"]},COMP_ARM:{label:"Fornisce competenza in armature marziali?",tag:"select",values:["0","1"]}},WIKI:{NOME:{label:"Titolo",tag:"input",inputType:"text"},DESCRIZIONE:{label:"Contenuto",tag:"textarea"}}},classes:["Arcanista","Artefice","Canaglia","Chimerista","Elementalista","Entropista","Furia","Guardiano","Lama Oscura","Maestro d'Armi","Oratore","Sapiente","Spiritista","Tiratore","Viandante"],img:{classes:{},items:{}},default:[{RARITA:"BASE",NOME:"Colpo Senz'Armi",CATEGORIA:"Da Rissa",MARZIALE:"",COSTO:"0",PRECISIONE:"[DES+VIG]",DANNO:"[TM+0]",TIPO_DANNO:"fisico",MANI:"Una",RAGGIO:"Mischia",QUALITA:"Sempre equipaggiato negli slot mano vuoti.",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",TIPO_DIF:"",TIPO_DIF_MAG:""},{RARITA:"BASE",NOME:"Nessuna",CATEGORIA:"Armatura",MARZIALE:"",COSTO:"0",PRECISIONE:"",DANNO:"",TIPO_DANNO:"",MANI:"Corpo",RAGGIO:"",QUALITA:"Nessuna Qualita'.",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",TIPO_DIF:"MOD",TIPO_DIF_MAG:"MOD"}],items:[{RARITA:"BASE",NOME:"Colpo Senz'Armi",CATEGORIA:"Da Rissa",MARZIALE:"",COSTO:"0",PRECISIONE:"[DES+VIG]",DANNO:"[TM+0]",TIPO_DANNO:"fisico",MANI:"Una",RAGGIO:"Mischia",QUALITA:"Sempre equipaggiato negli slot mano vuoti.",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",TIPO_DIF:"",TIPO_DIF_MAG:""},{RARITA:"BASE",NOME:"Improvvisata (Misc.)",CATEGORIA:"Da Rissa",MARZIALE:"",COSTO:"0",PRECISIONE:"[DES+VIG]",DANNO:"[TM+2]",TIPO_DANNO:"fisico",MANI:"Una",RAGGIO:"Mischia",QUALITA:"<p style='color:red;'>Si rompe dopo l'attacco.</p>",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",TIPO_DIF:"",TIPO_DIF_MAG:""},{RARITA:"BASE",NOME:"Improvvisata (Dist.)",CATEGORIA:"Da Lancio",MARZIALE:"",COSTO:"0",PRECISIONE:"[DES+VIG]",DANNO:"[TM+2]",TIPO_DANNO:"fisico",MANI:"Una",RAGGIO:"Distanza",QUALITA:"<p style='color:red;'>Si rompe dopo l'attacco.</p>",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",TIPO_DIF:"",TIPO_DIF_MAG:""},{RARITA:"BASE",NOME:"Nessuna",CATEGORIA:"Armatura",MARZIALE:"",COSTO:"0",PRECISIONE:"",DANNO:"",TIPO_DANNO:"",MANI:"Corpo",RAGGIO:"",QUALITA:"Nessuna Qualita'.",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",TIPO_DIF:"MOD",TIPO_DIF_MAG:"MOD"}],abilities:[{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Arcanista",NOME:"ABILITA' DA ARCANISTA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Artefice",NOME:"ABILITA' DA ARTEFICE",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Canaglia",NOME:"ABILITA' DA CANAGLIA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Chimerista",NOME:"ABILITA' DA CHIMERISTA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Elementalista",NOME:"ABILITA' DA ELEMENTALISTA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Entropista",NOME:"ABILITA' DA ENTROPISTA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Furia",NOME:"ABILITA' DA FURIA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Guardiano",NOME:"ABILITA' DA GUARDIANO",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Lama Oscura",NOME:"ABILITA' DA LAMA OSCURA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Maestro d'Armi",NOME:"ABILITA' DA MAESTRO D'ARMI",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Oratore",NOME:"ABILITA' DA ORATORE",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Sapiente",NOME:"ABILITA' DA SAPIENTE",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Spiritista",NOME:"ABILITA' DA SPIRITISTA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Tiratore",NOME:"ABILITA' DA TIRATORE",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Abilita'",CAPACITA:"",MAX_LA:"1",CLASSE:"Viandante",NOME:"ABILITA' DA VIANDANTE",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Abilita' generica di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Arcanista",NOME:"Beneficio di classe: Arcanista",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Artefice",NOME:"Beneficio di classe: Artefice",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Canaglia",NOME:"Beneficio di classe: Canaglia",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Chimerista",NOME:"Beneficio di classe: Chimerista",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Elementalista",NOME:"Beneficio di classe: Elementalista",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Entropista",NOME:"Beneficio di classe: Entropista",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Furia",NOME:"Beneficio di classe: Furia",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Guardiano",NOME:"Beneficio di classe: Guardiano",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Lama Oscura",NOME:"Beneficio di classe: Lama Oscura",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Maestro d'Armi",NOME:"Beneficio di classe: Maestro d'Armi",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Oratore",NOME:"Beneficio di classe: Oratore",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Sapiente",NOME:"Beneficio di classe: Sapiente",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Spiritista",NOME:"Beneficio di classe: Spiritista",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Tiratore",NOME:"Beneficio di classe: Tiratore",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Beneficio",CAPACITA:"",MAX_LA:"",CLASSE:"Viandante",NOME:"Beneficio di classe: Viandante",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"",TESTO:"Beneficio generico di classe. Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Eroica",CAPACITA:"",MAX_LA:"1",CLASSE:"",NOME:"ABILITA' EROICA",OFFENSIVO:"",COSTO:"",BERSAGLIO:"",DURATA:"",REQUISITI:"Requisiti: devi aver padroneggiato almeno una classe. ",TESTO:"Generica abilita' eroica ottenuta al raggiungimento del lv 10 in una classe.  Si puo' modificare come meglio si desidera dal menu' Modifica",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Incantesimo",CAPACITA:"x",MAX_LA:"1",CLASSE:"Elementalista",NOME:"Incantesimo Elementale",OFFENSIVO:"",COSTO:"10",BERSAGLIO:"Incantatore",DURATA:"Istantanea",REQUISITI:"MAGIA ELEMENTALE",TESTO:"<i>Testo dell'incantesimo</i>",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Incantesimo",CAPACITA:"x",MAX_LA:"1",CLASSE:"Entropista",NOME:"Incantesimo Entropico",OFFENSIVO:"",COSTO:"10",BERSAGLIO:"Incantatore",DURATA:"SceIstantaneana",REQUISITI:"MAGIA ENTROPICA",TESTO:"<i>Testo dell'incantesimo</i>",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"},{TIPO:"Incantesimo",CAPACITA:"x",MAX_LA:"1",CLASSE:"Spiritista",NOME:"Incantesimo Spirituale",OFFENSIVO:"",COSTO:"10",BERSAGLIO:"Incantatore",DURATA:"Istantanea",REQUISITI:"MAGIA SPIRITUALE",TESTO:"<i>Testo dell'incantesimo</i>",MOD_PV:"0",MOD_PM:"0",MOD_PI:"0",MOD_INIZ:"0",MOD_DIF:"0",MOD_DIFM:"0",COMP_MIS:"0",COMP_DIS:"0",COMP_SCU:"0",COMP_ARM:"0"}],bestiary:[{NOME:"Lupo",IMG:"data:image/png;base64,/9j/4AAQSkZJRgABAQEAkACQAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAB6AHoDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD6pooooAKjkmijdEkkRWc4UMcbj6D1qSqGuaRY65pk2n6pAs9rKMMp4I9weoI9RQA/+0rUap/Z7yFLsx+aqMCN69Mqehx3HUVcr5P8bwXfgzxJaNp3iptXtoZW8gC4LzWvI+RwDt9vfH8NeteD/izaXq20Wshbd5flEgPBPqM9R7dR784Vx2PVqKhtbqC7TfbSpKo67TnH19KmpiCiiigAoritI8WIfiBeeHJ8L5sP2u2JcHPJyo9cgb/pmu1oAKKZFLHLv8t1bYxRsHoR1FPoAKKKKAA9Kx9J8S6Rqt5PZ2V7G17AxWW2kBjlXHqjANj3xitivOfjJ4R/t3SY73StNuLnXoGAge2dEbH+2WZeB2wcg9O9AHo1FfOOmeOPHPgO4gt/E9pcXNpJwEvTliQPmEcw6np13D6V7b4S8Y6N4qtw+lXQM4UNJbSfLLH9V7j3GR70Aat7pWn3zh72wtLhx0aaFXI/MV8tfFbwo/hHxv8Auoz/AGJdt50Cj7seTyv4Nx9CvrX1jXF/FnwwPE3hK5ihjD39qDPb4HzMR1QfUD8wPSlJXRUXZ3PIPDXiO5014G+074U+XYzENGP9lhyF/HafevXtA8YpcAJO/nj2AEwHrsHDj3Tn/Z7183aCZHQRo4DjI5OOP8/zFdG8lwLfYjkTJhhzzkdwe1c0K2vLLc662GsueOx9P288VzAk1vIksTjcro2Qw9Qao65qFvYWbG5uI4FZSWd2xsQfeb8Bx9SPWvGLHxhri2QW2j+z6kSFa5UbvPx13x42l/8AbHNTXpuNQiabW5nnbGXRnLDj1A/QLxW/Ojjsec+JfENy/jlfEtmpt3jnRrdANuI1wqqfqoHy/wC9X1ZFqdrJo8Wpq5+ySQrOrY5KkZHHrz0r5M1aM3dwghicu8g8qJBkkZr1zxd4jk0XwZaaQ6+TePZxwG3VgfssYTaSzf3zgr7YP4vmA2fgnrA1iPxPPjaZdUa42E/d3ovH/jtelZ5x3r59/Z31ax0v/hIptQvIbaJ1jlJlcLwC/QdzyentXaeFfG1zr/xMubcRzRaSunFoYyuWJ8xcOw/hJBPH0HWmmI9PoqsJ5mJC2xX08xwM/lml82f/AJ4D/vv/AOtTAsUUUUAcn8T/AAqni7wlc2AA+1Rnz7ZvSRc4H4jI/Gvku0ubvT7yJ45JILpGzHMjMrBh/wCgkV9wV80/HLw2NC8VNqK2+/StTPmnbx5c38f58N+J/u1L01KSvozS8I/GnU7CWODxRbfbLP7v2mIBZlPuPuv+GD9a73X/ABd/aH2K68HTi4cwyJLMyNshVtpyykDLjbwD0z0Oa8Q8FeHJfF2qrb3WYdNgIM9yOcg9AP8AbJ/qa+hrCxtdPsYrOwgS3toRtUDr+fc+9En2FyuO543daNaLPdz3Fsbi4LNNI7HJzjczFfuqKsWVrHHDETGiZAOwDgGtnxrrHh+wtprKe4dEeULcRWSb3PPAc9EycdTWXCUuGW4W38gYwkZfeR7k9zWbRrEt+cQmM7V9qz7i4lnmWCGN5E9AeM+9WbqN/scNxnYkkuyL/ppgEkj2Hr9KbZ3ItXy4PI7UgNLRrdNKD3CBBeHkSnnZ9K8+8c3v2h2jjkLp96WQ9XNdbf373C+XGCid89TXGahaz3zm2Fs8ab/3kh7/AP1sYoRLKXh7yo9OluyAXeTZGPpW9YRyRu95HPqAuZ/9ZJbyOM+2QKz7LSb2BcQ2gcZOxxKAQP6VYm1K5h2WFvBDbTOQm/fv8v3q0xNG0tvIkfnjUdTR8bihnJ/nUya1qoRR/a970/vmsXXZ57G4zzNDxjHJz71RTWLjaOX6elVzk2PrmikdgilmICgZJ9BXNx+L7S41iLTrG0u7mV4/OMihFRE9W3MCPoRmqEdLXP8AjnSrDXNBl07UEDtJ80OPvK46OPYZ59s1bvLy5VWw0MK8cgGRvy4x+tZ0RkbccyNuGXdzlnPoT/QYApXHYwvDWg2Xh/TIdO02PFvAOXJ5kf8A56H/ADwK4nXvGN3rszW3hbz5LOK4ENybeMmd0zglP7gHr1PbFeqLGM5I/On/AIflWVSDmrJ2LU1F6nmt9oN7qHhy/wBB0vToLOzu2ik86dNjqUkUuMDLc7B15yxra0rwRGiIdWuDcgf8so/3cf49z+ddioHGQKS4njHyYJXO0knAHFEKfJBRk7ic7u5x9/oEmq6glwZBbWcKeXCcc47lE7dsZ/Kobzw/plvbPJPE4QfxvmaRz7Dpn8K6q0nt7uHfHPHMwzl4zx16Ux7UPMHPz4+UZpgeJ3kcU1+qaXZ3oUk/J5jlz9f4B+A/GpdRSSxmjimIMpiDlAc7OT+ten65Pb2ltIX5c/5xXkWp3X2rUJpz95z+gpSKKGsaw9lb+UiSSTSdAmen4ViWYuYL8Xd/FcwYH7sPGcDPersniOC1laOCN53+7vHGD7UH7bqUmY7aTd93MsmU/I0dALJv45It7So49Qc02Mx+WvToKlOlwXcDQXdmlpeRj78QGD78dazk0qcKv76Pp6mgD7I615t4d8J2vgvxHqxsnVbLUdkkSFeYsFsoPUDPH4V6TWX4h0ldWswiyGG4jO6KUDO0+hHcH0rZmRnajfW1havcXs6RwoMl3PGK4y/+KegWEavM80cb5aMyROnmj/Y457VyvxA8LeKtcmtdK+0WkJeZY2RpWCyDDEOSV+7047n/AGq6LWfhNfa54S0bR9X1SGW405z5d5HGQyxkYKFc/Px3yvT8ajU0VuoX/wATba08PQ63Ppl2NNnfZFLgEOeeOD14PWmWHxMtLrQJNcFt/wAS2KUQyyCQF4iem9O1X4vhFbt4afRX1OeCzaQSNFCoMbMvRgDyue4zWHqHgLwp4P8ADk1lPb3V5f3qqHtkuGxIyk7X+UZGDyB+HQGk246jjFSdo7jdS+LmmJpn2yySS5h83yf3Q534zjn29q4PXvHWs+Jrh7DR8wxSIeEJ8yTjpk4x+Aog8IXFnHJNb6a6JbDMiIQ7xgr99wOfxxXR+BtEtjd2msgXJZIiqGdAAXzjIPUjHqO9YKpOo9DsnRpUYXerO88GadJonhuws7ojzoYwsmOme/61pXN84RihAUD6VmzXBK/O+BWTqtwHiESyYJO6RBJsOz3710WZw3MvxHqKTwO5R3c5XngY/wA/jXAPDO9yvILHsc8Ank/WtvxHffapFgtQY4IztTYcfiKoWZeDJPzt6nmokUMj0Ymcv5YEo43k81W2T6dcEu77M8E84ret7+KSXE2MjulF7HHdI6AJMj/zpDKBv5JkXlH9xTV2bR8grPmQ2oxHwR2PpU0d+/lr+6PQUCPrWiiitzIrXtja3yxi7gSXy3EiFhyjAggg9QcgVZoooAqapeJY2ckzkDapOT0AHU/569O9fP3inxhLc6nIPD0JvtWud6RzMV2rt6omerfdz6n/AICtesapYyeMNQnsnkli0S2l2XEkb4Ny6nmFfRRzvbqScA/LkeC/tBy3cPj3RNE06whtJYLRfsxtFKMdzkKQQeg2fUc1jUhz/FsdWHqKnot2RfDX/hIb3xVdPfy3NsI4il0JIyCQe3PvXqlzdR2sOTwiDAA9Ko6Ja35htrWV/tmt3Kqsju4AdlXrkcBVXd0/9mroZvhfLfYl1DX51uP7ltAixfiG3E/mK0pwUEY1qjm7nA674ngtMb54xJ2iJwa5S/12fUYXSe5gEZPKAE/1rI+JvgbW9F1fVXnWO8s9P8pmvYUC/JKcJuXs2RXMaLbi+TyBkuOpzxzVTmzNI7axuvuxmQPE5/dkHj6VvwJFcw/IcOODjtXlt5Bc6cGQFwgO4emRXaeGNUN7bCQ8SISjj1rE1Eug6O+zAmSo9K1iC9Xy87LkffjPbFSa9J9n1C3l/gm+Q/UdK5HUYMalK8ZK8np1oEzrdXBdHeE/OOQarRXknlJ+77CodN1EXSeVJxOB+D1opbqVHPagZ9eUUUVsZBRRRQAiqFGFAAznivO/iF4Du9a8Q2ev6NLbDUYYRbslzkLsy3KkAkNh2r0WigDE8JaINF0qOObY9643TyrzlvQE87R0H4nqTW3UVxMsSNktuxnCqXP5DmvOb74kzWzy20tlHb3MbbDJcbkVj6hf/sqANj4jLp2k+ANf81FJu4HQmT5mllZcKST1xx9AvHSvlDwvCg1hkHA8sg+/Nd98SfHE+tiWAzpNj5AF+4n0A5H1Ned6PdfYbw3PlmTgoB7/AOcVEho6nXoEMT8bg+/P5VheHpDDeNGhxkZ47/5zU11qs81mYyFyTyRWVaz+Rfwyemf6VJRt+J5ybW3QnpJx+VZM0nmS7/XrUmu3Aury3SM/J9+q+zMo981SJY1gQVcHawreg1ObyI8nnaO3tWQwzyBVuKNPLT6CiwXPtqiiirEFFFFABVe/Fy1nKti0SXJUiN5QSqn1IHX6VYooA8q1n4YazqK+bJ4xvpbktvYSIVjJ9grfL+Rrz3xR4G8aaervLbTX8YHM1vOZz+R+Y/itfS9UtbZk0a/dGKutvIQwOCDtPNKw7nxObWdriSOaCSNoztcSDBz+NP8AJCY4xjoKuqS0k5YknPeq0/8AF9adtBS3IWyNvTJqBUzKxCev8/8A9VRR/wCvm+oq9H92pDYqPCfMV+uOKsIn71D+NPTvUn9z/PeqSCQxOOfStFbYbRx2qn/9etmP/Vr9BTsK5//Z",LIVELLO:1,TIPO:"Bestia",DESCRIZIONE:"Doggo",TRATTI:"peloso, mordace, affamato",DES:8,INT:6,VIG:8,VOL:6,PV:40,PM:40,INIZ:6,DIF:"+1",DMAG:"+1",ELEM:{fisico:"",aria:"",fulmine:"",ombra:"",terra:"",fuoco:"",ghiaccio:"",luce:"",veleno:""},ATTACCHI:[{nome:"Morso",raggio:"M",TP:"[DES+VIG]",TD:"[TM+5]",tipo:"fisici"}],INCANTESIMI:[{nome:"Osso Rotante",offensivo:"1",TP:"[DES+VIG]",costo:"10 PM",bersagli:"Una creatura",durata:"Istantanea",descrizione:"Ti tira un osso ni' capo. <b>[TM+10]</b> danni."}],AZIONI:[{nome:"Fossa",azione:"1",descrizione:"Scava una fossa e si ripara da tutti gli attacchi per il prossimo turno"}],REGOLE:[{nome:"Fiuto",descrizione:"Impossibile da cogliere di sorpresa"}]}],wiki:[{NOME:"Articolo",DESCRIZIONE:"Descrizione"}]};if(window.indexedDB){FUDB.version=3,FUDB.tabList=["chars","libraries","chosenSet","EULA"],FUDB.open=function(e=null){var t=window.indexedDB.open("FUDB",this.version);t.onupgradeneeded=function(e){var t=e.target.result;FUDB.tabList.forEach(function(e){t.objectStoreNames.contains(e)||t.createObjectStore(e,{keyPath:"id"})}),console.log("Upgrade effettuato.")},t.onsuccess=function(t){FUDB.db=t.target.result,console.log("DB aperto."),null!=e&&e()},t.onerror=function(e){console.log("Si � verificato un errore nell'apertura del DB")}},FUDB.reset=function(){window.indexedDB.deleteDatabase("FUDB")};class e{constructor(e){this.tabName=e}add(e){var t=FUDB.db.transaction(this.tabName,"readwrite").objectStore(this.tabName).add({id:e.id,data:e.data});t.onsuccess=function(e){console.log("Valore inserito correttamente!")},t.onerror=function(t){console.log("Si � verificato un errore nell'inserimento di un oggetto in db. ID: "+e.id)}}update(e){var t=FUDB.db.transaction(this.tabName,"readwrite").objectStore(this.tabName).put({id:e.id,data:e.data});t.onsuccess=function(e){console.log("Oggetto salvato correttamente!")},t.onerror=function(t){console.log("Si � verificato un errore nell'inserimento di un oggetto in db. ID: "+e.id)}}get(e,t,n=null){var i=FUDB.db.transaction(this.tabName,"readonly").objectStore(this.tabName).get(e);i.onSuccessFn=t,i.onErrFn=n,i.onsuccess=function(e){void 0!==e.target.result?this.onSuccessFn(e.target.result):this.onErrFn()},i.onerror=function(t){console.log("Nessun oggetto '"+e+"' trovato."),this.onErrFn&&this.onErrFn()}}keys(e){var t=FUDB.db.transaction(this.tabName,"readonly").objectStore(this.tabName).getAllKeys();t.onSuccessFn=e,t.onsuccess=function(e){e.target.result.length>0&&console.log("Chiavi trovate in '"+e.target.source.name+"'."),this.onSuccessFn(e.target.result)},t.onerror=function(e){console.log("Si � verificato un errore nel reperire le chiavi della tabella "+this.tabName)}}delete(e,t){var n=FUDB.db.transaction(this.tabName,"readwrite").objectStore(this.tabName).delete(e);n.onSuccessFn=t,n.onsuccess=function(t){console.log("Oggetto '"+e+"' eliminato"),this.onSuccessFn()},n.onerror=function(t){console.log("Si � verificato un errore durante l'eliminazione dell'oggetto '"+e+"'")}}}FUDB.chars=new e("chars"),FUDB.libraries=new e("libraries"),FUDB.chosenSet=new e("chosenSet"),FUDB.EULA=new e("EULA")}else console.log("Il tuo browser non supporta indexedDB: effettuare i salvataggi tramite l'export dati."),document.getElementById("manageCache").style.display="none";function resetCache(){window.confirm("Si conferma di voler procedere con la cancellazione di tutti i dati salvati localmente?")&&window.confirm("ATTENZIONE! Questo portera' alla rimozione irrecuperabile di TUTTI i dati salvati in cache. Vuoi comunque procedere?")&&FUDB.reset()}function startUpCharacter(){characterInfo=createNewCharacter(),updateSheet()}function createNewCharacter(){let e={autosave:!1,name:"...",img:"",sheetColor:"",levels:{},des:{base:6,temp:6},int:{base:6,temp:6},vig:{base:6,temp:6},vol:{base:6,temp:6},status:{slow:!1,confused:!1,weak:!1,shaken:!1,enraged:!1,poisoned:!1},traits:{identity:"...",theme:"...",origin:"..."},bonds:[],equip:{main:null,secondary:null,armor:null,accessory:null,bonusAccessory:null},inventory:[],fabula:{current:3},hp:{current:0,max:0,mod:0},mp:{current:0,max:0,mod:0},ip:{current:0,max:6,mod:0},zenit:{current:0},initMod:0,pDefMod:0,mDefMod:0,skills:[],martial:{melee:!1,range:!1,armor:!1,shield:!1},peculiarity:{pecName:"Nome peculiarita': ...",pecDesc:"Descrizione: ..."},zeroPowerProgress:0,zeroPower:{zeroName:"Nome potere: ...",zeroTrigger:"Innesco: ...",zeroEffect:"Effetto: ..."},notes:[]};return e}function setupEvents(){document.getElementById("closePopup").addEventListener("click",function(){document.getElementById("popup").style.display="none",setModal()}),document.getElementById("closePopup").appendChild(fetchSvgIcon("times")),"undefined"!=typeof Capacitor?document.getElementById("shareLobby").appendChild(fetchSvgIcon("share")):document.getElementById("shareLobby").appendChild(fetchSvgIcon("copy")),document.getElementById("popupContent").addEventListener("click",function(e){if(e.target&&"tip"==e.target.className){let t="/r "+e.target.innerHTML.replace("[","").replace("]","");waitForCallback=3,document.getElementById("rollResult").innerHTML="",sendInChat(t)}});let e=document.createElement("div");e.id="rollResult",e.innerHTML="",document.getElementById("popup").appendChild(e),document.getElementById("selectCharacterMode").addEventListener("click",function(e){selectToolkitMode("charSheet")}),document.getElementById("selectLibraryMode").addEventListener("click",function(e){selectToolkitMode("library")}),document.getElementById("selectBestiaryMode").addEventListener("click",function(e){populateSelect(document.getElementById("monsterList"),data.bestiary),selectToolkitMode("bestiary")}),document.getElementById("selectListToEdit").addEventListener("change",function(e){document.getElementById("selectListToEdit").firstElementChild.setAttribute("hidden",""),populateEditorSelect(),document.getElementById("confirmObjectToEdit").disabled=!1,document.getElementById("duplicateObject").disabled=!1,document.getElementById("deleteObject").disabled=!1}),document.getElementById("confirmObjectToEdit").addEventListener("click",function(e){if("Modifica"==document.getElementById("confirmObjectToEdit").innerHTML){document.getElementById("selectListToEdit").disabled=!0,document.getElementById("listToEdit").disabled=!0,openEditor(document.getElementById("listToEdit")[document.getElementById("listToEdit").selectedIndex].refObj,editLibrary,document.getElementById("libraryEditor")),document.getElementById("confirmObjectToEdit").innerHTML="Annulla";let e=document.getElementById("selectListToEdit").value,t=document.getElementById("listToEdit")[document.getElementById("listToEdit").selectedIndex].refObj;if("classes"==e||"items"==e){let n=document.createElement("div");n.className="imgSelector";let i=document.createElement("img");i.id="newImgPreview";let a=document.createElement("input");a.setAttribute("type","file");let l=document.createElement("h3");l.innerHTML="Immagine Entita'",l.style.marginBlockStart="0",i.src=data.img[e][Object.keys(data.img[e]).find(e=>e.toLowerCase()===t.NOME.toLowerCase())],a.addEventListener("change",function(e){encodeImage(this,function(e){i.src=e})}),n.appendChild(l),n.appendChild(i),n.appendChild(a),document.getElementById("libraryEditor").children[1].prepend(n)}}else"Annulla"==document.getElementById("confirmObjectToEdit").innerHTML&&resetEditorMenu()}),document.getElementById("duplicateObject").addEventListener("click",function(e){let t=document.getElementById("listToEdit")[document.getElementById("listToEdit").selectedIndex],n=null,i="";if(document.getElementById("newImgPreview")&&(n=document.getElementById("newImgPreview").src),window.confirm("Si vuole duplicare l'entita' '"+document.getElementById("listToEdit").value+"'?")){if(t.refObj.hasOwnProperty("arr")&&t.refObj.hasOwnProperty("idx"))i=progressiveNaming(t.text,t.refObj.arr),t.refObj.arr.push(i);else{let e=JSON.parse(JSON.stringify(t.refObj)),n=data[document.getElementById("selectListToEdit").value].map(function(e){return e.NOME});i=progressiveNaming(t.refObj.NOME,n),e.NOME=i,data[document.getElementById("selectListToEdit").value].push(e)}n&&(data.img[document.getElementById("selectListToEdit").value][i]=n),resetEditorMenu(),setLibraryToBeSaved(!0),populateEditorSelect()}}),document.getElementById("deleteObject").addEventListener("click",function(e){let t=document.getElementById("listToEdit")[document.getElementById("listToEdit").selectedIndex];if(window.confirm("Si vuole eliminare l'entita' '"+document.getElementById("listToEdit").value+"'?")){if(t.refObj.hasOwnProperty("arr")&&t.refObj.hasOwnProperty("idx"))t.refObj.arr.splice(t.refObj.idx,1);else{let e=t.refObj,n=data[document.getElementById("selectListToEdit").value];for(let t=0;t<n.length;t++)if(e.NOME===n[t].NOME){n.splice(t,1);break}}resetEditorMenu(),setLibraryToBeSaved(!0),populateEditorSelect()}}),document.getElementById("putMonsterInEncounter").addEventListener("click",function(e){}),document.getElementById("confirmMonsterToEdit").addEventListener("click",function(e){document.getElementById("bestiaryEditor").innerHTML="",document.getElementById("bestiaryEditor").appendChild(showMonster(document.getElementById("monsterList")[document.getElementById("monsterList").selectedIndex].refObj,["head","desc","traits","stats","defs","atks","spells","actions","rules"]))}),document.getElementById("duplicateMonster").addEventListener("click",function(e){}),document.getElementById("deleteMonster").addEventListener("click",function(e){}),document.getElementById("contextMenu").children[0].addEventListener("click",function(e){sendInChat(),setModal()}),document.getElementById("contextMenu").children[1].addEventListener("click",function(e){equip("main"),setModal()}),document.getElementById("contextMenu").children[2].addEventListener("click",function(e){equip("secondary"),setModal()}),document.getElementById("contextMenu").children[3].addEventListener("click",function(e){equip("armor"),setModal()}),document.getElementById("contextMenu").children[4].addEventListener("click",function(e){equip("accessory"),setModal()}),document.getElementById("contextMenu").children[5].addEventListener("click",function(e){equip("bonusAccessory"),setModal()}),document.getElementById("contextMenu").children[6].addEventListener("click",function(e){dropItem("before"),setModal()}),document.getElementById("contextMenu").children[7].addEventListener("click",function(e){dropItem("after"),setModal()}),document.getElementById("backItems").addEventListener("click",function(e){switchContextListPage(-1)}),document.getElementById("forwardItems").addEventListener("click",function(e){switchContextListPage(1)}),document.getElementById("loadPCImg").addEventListener("change",function(e){encodeImage(this,function(e){characterInfo.img=e,refreshProfileImage()})}),document.getElementById("levelRecap").appendChild(expandIcon(!0,document.getElementById("levelDetail"))),document.getElementById("combatStats").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("traits").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("bonds").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("equip").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("inventory").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("abilities").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("equipAb").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("spells").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("peculiarity").firstElementChild.appendChild(expandIcon(!0)),document.getElementById("zeroPower").firstElementChild.appendChild(expandIcon(!0)),document.getElementById("notes").firstElementChild.appendChild(expandIcon(!1)),document.getElementById("goldAndIP").appendChild(expandIcon(!1,document.getElementById("inventoryList"))),document.getElementById("manageCache").parentNode.previousElementSibling.appendChild(expandIcon(!1)),document.getElementById("libraryManagement").parentNode.previousElementSibling.appendChild(expandIcon(!1)),document.getElementById("availableItems").previousElementSibling.appendChild(expandIcon()),document.getElementById("availableAbilities").previousElementSibling.appendChild(expandIcon()),document.getElementById("wikiEntries").previousElementSibling.appendChild(expandIcon()),document.getElementById("loadPCImg").parentNode.previousElementSibling.appendChild(expandIcon(!1)),document.getElementById("colorPicker").parentNode.previousElementSibling.appendChild(expandIcon(!1)),document.getElementById("colorPicker").addEventListener("change",function(e){characterInfo.sheetColor=e.target.value,editPalette()}),document.getElementById("desIcon").appendChild(fetchSvgIcon("running")),document.getElementById("intIcon").appendChild(fetchSvgIcon("bolt")),document.getElementById("vigIcon").appendChild(fetchSvgIcon("bone")),document.getElementById("volIcon").appendChild(fetchSvgIcon("book")),document.getElementById("desIcon").firstChild.popupContent=createRoller({type:"stats"}),document.getElementById("intIcon").firstChild.popupContent=createRoller({type:"stats"}),document.getElementById("vigIcon").firstChild.popupContent=createRoller({type:"stats"}),document.getElementById("volIcon").firstChild.popupContent=createRoller({type:"stats"}),document.getElementById("desTag").popupContent=createRoller({type:"stats"}),document.getElementById("intTag").popupContent=createRoller({type:"stats"}),document.getElementById("vigTag").popupContent=createRoller({type:"stats"}),document.getElementById("volTag").popupContent=createRoller({type:"stats"}),document.getElementById("rollForInitiative").popupContent=createRoller({type:"stats"}),document.getElementById("desIcon").addEventListener("click",showPopup),document.getElementById("intIcon").addEventListener("click",showPopup),document.getElementById("vigIcon").addEventListener("click",showPopup),document.getElementById("volIcon").addEventListener("click",showPopup),document.getElementById("desTag").addEventListener("click",showPopup),document.getElementById("intTag").addEventListener("click",showPopup),document.getElementById("vigTag").addEventListener("click",showPopup),document.getElementById("volTag").addEventListener("click",showPopup),document.getElementById("modalBckgr").addEventListener("click",function(e){setModal()}),document.getElementById("openCompendium").appendChild(fetchSvgIcon("archive")),document.getElementById("openGraphics").appendChild(fetchSvgIcon("pen")),document.getElementById("openMenu").appendChild(fetchSvgIcon("bars")),document.getElementById("openClocks").appendChild(fetchSvgIcon("clock")),document.getElementById("openLobby").appendChild(fetchSvgIcon("users")),document.getElementById("openChat").appendChild(fetchSvgIcon("comment")),document.getElementById("closeMenu").appendChild(fetchSvgIcon("times")),document.getElementById("closeLobby").appendChild(fetchSvgIcon("times")),document.getElementById("closeChat").appendChild(fetchSvgIcon("chevron-right")),document.getElementById("sendChatMsg").appendChild(fetchSvgIcon("paper-plane")),document.getElementById("closeModal").appendChild(fetchSvgIcon("times")),document.getElementById("closeEditor").appendChild(fetchSvgIcon("times")),document.getElementById("openCompendium").addEventListener("click",function(e){setModal()}),document.getElementById("openGraphics").addEventListener("click",function(e){setModal("graphFU")}),document.getElementById("openMenu").addEventListener("click",function(e){setModal("FUMenu")}),document.getElementById("openClocks").addEventListener("click",function(e){setModal("FUClocks")}),document.getElementById("openLobby").addEventListener("click",function(e){setModal("FULobby")}),document.getElementById("openChat").addEventListener("click",function(e){setModal("FUChat"),document.getElementById("chatLog").scrollTo(0,document.getElementById("chatLog").scrollHeight),document.getElementById("openChat").classList.remove("chatNotification")}),document.getElementById("closeMenu").addEventListener("click",function(e){setModal()}),document.getElementById("closeLobby").addEventListener("click",function(e){setModal()}),document.getElementById("closeChat").addEventListener("click",function(e){setModal(),document.getElementById("openChat").classList.remove("chatNotification")}),document.getElementById("sendChatMsg").addEventListener("click",function(e){sendMessage()});let t=!1;document.getElementById("msgToSend").addEventListener("keydown",function(e){"ShiftLeft"!=e.code&&"ShiftRight"!=e.code||(t=!0)}),document.getElementById("msgToSend").addEventListener("keyup",function(e){signalWriting(),"Enter"!=e.code&&"NumpadEnter"!=e.code&&13!==e.keyCode||t||sendMessage(),"ShiftLeft"!=e.code&&"ShiftRight"!=e.code||(t=!1)}),document.getElementById("closeModal").addEventListener("click",function(e){setModal()}),document.getElementById("closeEditor").addEventListener("click",function(e){setModal()}),document.getElementById("resetBtn").addEventListener("click",resetCache),document.getElementById("saveBtn").addEventListener("click",saveCharacter),document.getElementById("loadBtn").addEventListener("click",fetchCharFromMemory),document.getElementById("deleteBtn").addEventListener("click",deleteCharacter),document.getElementById("shareChar").addEventListener("click",function(){if(p2p.peer){let e=document.getElementById("listOfChars");e.value?window.confirm("Confermi di voler condividere la scheda di '"+e.value+"'?")&&FUDB.chars.get(e.value,function(e){console.log("Condivisione in corso..."),shareCharacter(e.data,usListChar.value),console.log("Condivisione completata.")},function(){console.log("Nessun personaggio da condividere.")}):console.log("Nessun personaggio da condividere.")}else alert("Nessuna lobby attiva")}),document.getElementById("exportChar").addEventListener("click",download),document.getElementById("autosaveFlag").addEventListener("click",function(e){void 0!==characterInfo.autosave&&(characterInfo.autosave=document.getElementById("autosaveFlag").checked)}),document.getElementById("loadLib").addEventListener("click",function(e){fetchLibraryFromMemory()}),document.getElementById("removeLib").addEventListener("click",deleteLibrary),document.getElementById("shareLib").addEventListener("click",function(){if(p2p.peer){let e=document.getElementById("listOfLibraries").value;null!=e?window.confirm("Confermi di voler condividere la libreria '"+e+"'?")&&FUDB.libraries.get(e,function(e){console.log("Condivisione in corso..."),shareLibrary(e.data,null,usListLib.value),console.log("Condivisione completata.")},function(){console.log("Nessuna libreria da condividere.")}):console.log("Nessuna libreria da condividere.")}else alert("Nessuna lobby attiva")}),document.getElementById("broadcastLib").addEventListener("click",function(){if(p2p.peer){let e=document.getElementById("listOfLibraries").value;null!=e?window.confirm("Confermi di voler condividere la libreria '"+e+"'?")&&FUDB.libraries.get(e,function(e){console.log("Condivisione in corso..."),broadcastLibrary(e.data),console.log("Condivisione completata.")},function(){console.log("Nessuna libreria da condividere.")}):console.log("Nessuna libreria da condividere.")}else alert("Nessuna lobby attiva")}),document.getElementById("shareLobby").addEventListener("click",function(){shareLobby()}),document.getElementById("kickUser").addEventListener("click",function(){if(p2p.peer&&p2p.master){let e=document.getElementById("usListKick").value;p2p.connList.filter(t=>t.peer===e).length>0?window.confirm("Confermi di voler espellere '"+p2p.connList.filter(t=>t.peer===e)[0].userName+"'?")&&kickUser(e):console.log("Nessun utente valido � stato indicato.")}else alert("Nessuna lobby attiva")}),document.getElementById("exportLib").addEventListener("click",downloadLibrary),document.getElementById("setLib").addEventListener("click",saveDefaultLibrary),document.getElementById("saveLib").addEventListener("click",saveLibraryPrompt),document.getElementById("charLoader").addEventListener("change",upload),document.getElementById("libraryLoader").addEventListener("change",uploadLibrary),document.getElementById("name").addEventListener("click",addName),document.getElementById("pecName").addEventListener("click",e=>{editPeculiarity(e,"Nome peculiarita': ...","pecName")}),document.getElementById("pecDesc").addEventListener("click",e=>{editPeculiarity(e,"Descrizione: ...","pecDesc")}),document.getElementById("zeroClock").appendChild(zeroPowerClock()),document.getElementById("zeroName").addEventListener("click",e=>{editZeroPower(e,"Nome potere: ...","zeroName")}),document.getElementById("zeroTrigger").addEventListener("click",e=>{editZeroPower(e,"Innesco: ...","zeroTrigger")}),document.getElementById("zeroEffect").addEventListener("click",e=>{editZeroPower(e,"Effetto: ...","zeroEffect")}),document.getElementById("rollForInitiative").addEventListener("click",e=>{showPopup(e),document.getElementById("pz1").value="des",document.getElementById("pz2").value="int",document.getElementById("pz3").value=calculateInitiative(characterInfo)}),document.getElementById("initiative").addEventListener("dblclick",addInitMod),document.getElementById("defense").addEventListener("dblclick",addPDefMod),document.getElementById("magDefense").addEventListener("dblclick",addMDefMod),document.getElementById("ip_max").addEventListener("click",addIpMod),document.getElementById("addNewClass").addEventListener("click",addClass),document.getElementById("addNewClass").style.width="100%";let n=fetchSvgIcon("plus");function i(e){let t=e.target.statParam;if("base"==t[1]){let n=Array.from(e.target.children).indexOf(e.target.querySelectorAll("[value='"+characterInfo[t[0]].base+"'")[0]),i=Array.from(e.target.children).indexOf(e.target.querySelectorAll("[value='"+characterInfo[t[0]].temp+"'")[0]);characterInfo[t[0]].temp=e.target[Math.min(e.target.children.length-1,Math.max(0,e.target.selectedIndex-(n-i)))].value}characterInfo[t[0]][t[1]]=Number(e.target.value),updateSheet()}n.style.margin="auto",document.getElementById("addNewClass").appendChild(n);function a(e){characterInfo.status[e.target.id]=e.target.checked,updateSheet()}["des","int","vig","vol"].forEach(function(e){let t=e.charAt(0).toUpperCase()+e.slice(1);document.getElementById("base"+t).statParam=[e,"base"],document.getElementById("temp"+t).statParam=[e,"temp"],document.getElementById("base"+t).addEventListener("change",i),document.getElementById("temp"+t).addEventListener("change",i)}),document.getElementById("slow").addEventListener("change",a),document.getElementById("confused").addEventListener("change",a),document.getElementById("weak").addEventListener("change",a),document.getElementById("shaken").addEventListener("change",a),document.getElementById("enraged").addEventListener("change",a),document.getElementById("poisoned").addEventListener("change",a),document.getElementById("identity").addEventListener("click",addTrait),document.getElementById("theme").addEventListener("click",addTrait),document.getElementById("origin").addEventListener("click",addTrait),document.getElementById("addNewBond").addEventListener("click",addBond),document.getElementById("addNewBond").appendChild(fetchSvgIcon("plus")),document.getElementById("mainHand").addEventListener("contextmenu",function(e){buildItemContextList("mainHand"),buildContextMenu(document.getElementById("mainHand"),[e.clientX,e.clientY],{directEquip:!0}),e.preventDefault(e)}),document.getElementById("secondaryHand").addEventListener("contextmenu",function(e){buildItemContextList("secondaryHand"),buildContextMenu(document.getElementById("secondaryHand"),[e.clientX,e.clientY],{directEquip:!0}),e.preventDefault(e)}),document.getElementById("armor").addEventListener("contextmenu",function(e){buildItemContextList("armor"),buildContextMenu(document.getElementById("armor"),[e.clientX,e.clientY],{directEquip:!0}),e.preventDefault(e)}),document.getElementById("accessory").addEventListener("contextmenu",function(e){buildItemContextList("accessory"),buildContextMenu(document.getElementById("accessory"),[e.clientX,e.clientY],{directEquip:!0}),e.preventDefault(e)}),document.getElementById("bonusAccessory").addEventListener("contextmenu",function(e){buildItemContextList("bonusAccessory"),buildContextMenu(document.getElementById("bonusAccessory"),[e.clientX,e.clientY],{directEquip:!0}),e.preventDefault(e)}),document.getElementById("mainHand").addEventListener("dragover",allowDrop),document.getElementById("secondaryHand").addEventListener("dragover",allowDrop),document.getElementById("armor").addEventListener("dragover",allowDrop),document.getElementById("accessory").addEventListener("dragover",allowDrop),document.getElementById("bonusAccessory").addEventListener("dragover",allowDrop),document.getElementById("mainHand").addEventListener("drop",function(e){equip(this.id)}),document.getElementById("secondaryHand").addEventListener("drop",function(e){equip(this.id)}),document.getElementById("armor").addEventListener("drop",function(e){equip(this.id)}),document.getElementById("accessory").addEventListener("drop",function(e){equip(this.id)}),document.getElementById("bonusAccessory").addEventListener("drop",function(e){equip(this.id)}),document.getElementById("removeMain").appendChild(fetchSvgIcon("trash")),document.getElementById("removeSecondary").appendChild(fetchSvgIcon("trash")),document.getElementById("removeArmor").appendChild(fetchSvgIcon("trash")),document.getElementById("removeAccessory").appendChild(fetchSvgIcon("trash")),document.getElementById("removeBonusAccessory").appendChild(fetchSvgIcon("trash")),document.getElementById("removeMain").firstChild.slot="main",document.getElementById("removeSecondary").firstChild.slot="secondary",document.getElementById("removeArmor").firstChild.slot="armor",document.getElementById("removeAccessory").firstChild.slot="accessory",document.getElementById("removeBonusAccessory").firstChild.slot="bonusAccessory",document.getElementById("removeMain").firstChild.addEventListener("click",unequip),document.getElementById("removeSecondary").firstChild.addEventListener("click",unequip),document.getElementById("removeArmor").firstChild.addEventListener("click",unequip),document.getElementById("removeAccessory").firstChild.addEventListener("click",unequip),document.getElementById("removeBonusAccessory").firstChild.addEventListener("click",unequip),document.getElementById("addInvContainer").addEventListener("click",function(e){addInventoryContainer()}),document.getElementById("addInvContainer").prepend(fetchSvgIcon("plus")),document.getElementById("addNote").addEventListener("click",function(e){addNewNote()}),document.getElementById("ipIcon").appendChild(fetchSvgIcon("briefcase")),document.getElementById("ipIcon").firstChild.popupContent="<div>Elisir [3 PI]: Una creatura recupera 50 Punti Mente.<br>Rimedio [3 PI]: Una creatura recupera 50 Punti Vita.<br>Tonico [2 PI]: Una creatura guarisce da uno status.<br>Scheggia Elementale [2 PI]: Una creatura subisce 10 danni da (scegliere tra: aria, fulmine, fuoco, ghiaccio, terra).<br>Tenda Magica [4 PI]: Permette al gruppo di riposare nelle terre selvagge.<br></div>",document.getElementById("ipIcon").firstChild.addEventListener("click",showPopup),document.getElementById("znIcon").appendChild(fetchSvgIcon("coins")),document.getElementById("fabula")||document.getElementById("scores").appendChild(createTracker("fabula")),document.getElementById("hp")||document.getElementById("scores").appendChild(createTracker("hp")),document.getElementById("mp")||document.getElementById("scores").appendChild(createTracker("mp")),document.getElementById("ip").addEventListener("change",()=>{updateScore(characterInfo.ip,document.getElementById("ip").value),updateSheet()}),document.getElementById("zenit").addEventListener("change",()=>{updateScore(characterInfo.zenit,document.getElementById("zenit").value),updateSheet()}),document.getElementById("book").addEventListener("click",function(){characterInfo.fabula.current++,document.getElementById("fabula").value=characterInfo.fabula.current})}function createRoller(e={}){let t=document.createElement("div");t.id="rollerPopup";let n=document.createElement("select"),i=document.createElement("select"),a=document.createElement("input");n.id="pz1",i.id="pz2",a.id="pz3",n.innerHTML="<option value='6'>d6</option>   \t\t<option value='8'>d8</option>   \t\t<option value='10'>d10</option>   \t\t<option value='12'>d12</option>\t\t\t<option value='20'>d20</option>",null!=typeof e.type&&"stats"==e.type&&(n.innerHTML="<option value='des'>DES</option>   \t\t\t\t<option value='int'>INT</option>   \t\t\t\t<option value='vig'>VIG</option>   \t\t\t\t<option value='vol'>VOL</option>"),i.innerHTML=n.innerHTML,a.type="number",t.appendChild(n),t.appendChild(i),t.appendChild(a);let l=document.createElement("button");return l.innerHTML="Tira",l.addEventListener("click",function(t){waitForCallback=3,document.getElementById("rollResult").innerHTML="";let n=document.getElementById("pz1").value,i=document.getElementById("pz2").value,a=document.getElementById("pz3").value;null!=typeof e.type&&"stats"==e.type&&(n=getTotalEffectiveStat(document.getElementById("pz1").value),i=getTotalEffectiveStat(document.getElementById("pz2").value)),sendInChat("/r 1d"+n+"+1d"+i+(a>=0&&""!=a?"+":"")+a)}),t.appendChild(l),t}function showPopup(e){if(e.target.hasOwnProperty("popupContent")){let t=document.getElementById("popup");document.getElementById("popupContent").innerHTML="",e.target.popupContent instanceof HTMLElement?document.getElementById("popupContent").appendChild(e.target.popupContent):document.getElementById("popupContent").innerHTML=e.target.popupContent?e.target.popupContent:"Niente",t.style.display="block";let n=null;n=document.getElementById("FUToolkit")?document.getElementById("FUToolkit"):document.body;e.target.x?e.target.x:(e.clientX,e.offsetX,document.getElementById("floatingtoolbar")&&n.scrollLeft),e.target.y?e.target.y:(e.clientY,e.offsetY,document.getElementById("floatingtoolbar")&&n.scrollTop);t.style.top="30%",t.style.height="auto",t.style.width="fit-content",t.style.minWidth="auto",setModal("popup")}}function turnOffPopup(){document.getElementById("popup").style.display="none",document.getElementById("sheetWrapper").removeEventListener("click",assignContainer)}function createTextInput(e,t){return createInput(e,t,"text")}function createInput(e,t,n){let i=document.createElement("input");i.type=n,i.setAttribute("newInput",!0),i.addEventListener("keydown",function(e){"Enter"==e.code||"NumpadEnter"==e.code||"Tab"==e.code||13===e.keyCode?document.activeElement.blur():"Escape"==e.code&&t()}),i.addEventListener("blur",function(t){e(t)}),i.addEventListener("click",function(e){i.getAttribute("newInput")&&(i.value="",i.removeAttribute("newInput"))});let a=fetchSvgIcon("check");return a.addEventListener("click",e),[i,a]}function addName(e){let t=createTextInput(function(e){updateName(t[0].value,document.getElementById("name"))},updateSheet);t.className="inRow",t[0].value=e.target.innerHTML,"..."!=e.target.innerHTML&&t[0].removeAttribute("newInput"),e.target.innerHTML="",e.target.appendChild(t[0]),e.target.appendChild(t[1])}function editPeculiarity(e,t,n){let i=createTextInput(function(e){updateValue(i[0].value,document.getElementById(n),t,["peculiarity",n])},updateSheet);i.className="inRow",i[0].value=e.target.innerHTML,"..."!=e.target.innerHTML&&i[0].removeAttribute("newInput"),e.target.innerHTML="",e.target.appendChild(i[0]),e.target.appendChild(i[1])}function editZeroPower(e,t,n){let i=createTextInput(function(e){updateValue(i[0].value,document.getElementById(n),t,["zeroPower",n])},updateSheet);i.className="inRow",i[0].value=e.target.innerHTML,"..."!=e.target.innerHTML&&i[0].removeAttribute("newInput"),e.target.innerHTML="",e.target.appendChild(i[0]),e.target.appendChild(i[1])}function updateValue(e,t,n="...",i=[]){""==e.trim()&&(e=n);let a=characterInfo,l="";if(i.length>0){for(let e=0;e<i.length;e++)""!=l&&a[l]&&(a=a[l]),l=i[e];a[l]=e}t.innerHTML=e}function addInitMod(e){addMod(e.target,"initMod")}function addPDefMod(e){addMod(e.target,"pDefMod")}function addMDefMod(e){addMod(e.target,"mDefMod")}function addIpMod(e){addMod(e.target,"ip.mod")}function addMod(e,t){let n=[],i=null,a="";"string"==typeof t?1==(n=t.split(".")).length?(i=characterInfo,a=t):(i=characterInfo[n[0]],a=n[1]):(i=t,a="mod");let l=createInput(function(t){i[a]=Number(l[0].value),e.classList.remove("inRow"),updateSheet(),updateClocks()},updateSheet,"number");l[0].value=i[a],l[0].removeAttribute("newInput"),l[0].style.width="5em",e.innerHTML="Mod.: ",e.appendChild(l[0]),e.appendChild(l[1])}function addClass(e){let t=document.createElement("div");t.innerHTML="<div>Seleziona una classe...</div>";let n=document.createElement("select"),i=0;if(data.classes.forEach(function(e){if(characterInfo.levels[e])characterInfo.levels[e]<data.maxLv&&i++;else{let t=document.createElement("option");t.value=e,t.innerHTML=e,n.appendChild(t)}}),i<data.maxClasses){let e=fetchSvgIcon("check");e.addEventListener("click",function(e){populateClass(n)}),t.appendChild(n),t.appendChild(e),document.getElementById("addNewClass").style.display="none",document.getElementById("levelDetail").appendChild(t)}}function addTrait(e){let t=createTextInput(function(n){populateTrait(t[0],e.target)},updateSheet);t[0].value=e.target.innerHTML,"..."!=e.target.innerHTML&&t[0].removeAttribute("newInput"),e.target.innerHTML="",e.target.appendChild(t[0]),e.target.appendChild(t[1])}function addBond(e){let t="bond_"+characterInfo.bonds.length;if(!document.getElementById(t)){let e=document.createElement("div"),n=createTextInput(function(t){populateBond(n[0],e)},updateSheet);n[0].value="Inserisci un nome...",n[0].id=t,n[0].bondRef=t,n[1].bondRef=t,e.appendChild(n[0]),e.appendChild(n[1]),document.getElementById("bondsList").appendChild(e)}}function addItem(){let e={},t=null,n=document.createElement("div");n.className="inColumn",n.style.width="100%",data.items.forEach(function(i){let a=JSON.parse(JSON.stringify(i));e.hasOwnProperty(a.CATEGORIA)||(e[a.CATEGORIA]=createItemHeader(a.CATEGORIA),n.appendChild(e[a.CATEGORIA])),t=e[a.CATEGORIA];let l=document.createElement("div");l.className="inRow";let o=fetchSvgIcon("angle-right");o.style.fontSize="x-large",o.title="Aggiungi alla scheda";let d=buildItem(a);function c(e){characterInfo.inventory.push(this.passedItem),populateItem(this.passedItem),resetModalContent()}d.style.width="100%",l.appendChild(d),l.setAttribute("RARITA",a.RARITA),l.setAttribute("RAGGIO",a.RAGGIO),l.setAttribute("NOME",a.NOME),l.setAttribute("CATEGORIA",a.CATEGORIA),l.setAttribute("MARZIALE",a.MARZIALE),l.setAttribute("TIPO_DANNO",a.TIPO_DANNO),l.setAttribute("MANI",a.MANI),l.passedItem=a,o.passedItem=a,l.addEventListener("dblclick",c),o.addEventListener("click",c),l.appendChild(o),t.appendChild(l)}),document.getElementById("availableItems").appendChild(n)}function addSkill(){let e={},t=null;if(Object.keys(characterInfo.levels).length>0){let n=document.createElement("div");n.className="inColumn",n.style.width="100%";let i=0,a=!1;Object.keys(characterInfo.levels).forEach(function(e){characterInfo.levels[e]==data.maxLv&&i++}),characterInfo.skills.forEach(function(e){"Eroica"==e.TIPO&&i--}),i<=0&&(a=!0),data.abilities.forEach(function(i){let l=!1;if(i=JSON.parse(JSON.stringify(i)),hasAbility(characterInfo,i.NOME)){let e=hasAbility(characterInfo,i.NOME);Number(characterInfo.skills[e].MAX_LA)<=Number(characterInfo.skills[e].LA)&&(l=!0)}let o=hasAbility(characterInfo,i.REQUISITI);if(o&&!l&&Number(characterInfo.skills[o].MAX_LA)>1){let e=0;for(let t=0;t<characterInfo.skills.length;t++)characterInfo.skills[t].REQUISITI==i.REQUISITI&&(e+=characterInfo.skills[t].LA*characterInfo.skills[t].SUBTIPO);e>=Number(characterInfo.skills[o].LA)+(hasAbility(characterInfo,"INCANTESIMI AGGIUNTIVI ("+i.CLASSE.toUpperCase()+")")?2:0)&&(l=!0)}if(!l)if("Abilita'"==i.TIPO&&hasLevels(characterInfo,i.CLASSE))""!=i.REQUISITI&&(hasAbility(characterInfo,i.REQUISITI)||(l=!0));else if("Incantesimo"==i.TIPO&&(hasLevels(characterInfo,i.CLASSE)||hasAbility(characterInfo,"INCANTESIMI AGGIUNTIVI ("+i.CLASSE.toUpperCase()+")"))||hasAbility(characterInfo,"COMETA")&&"COMETA"==i.REQUISITI||hasAbility(characterInfo,"VULCANO")&&"VULCANO"==i.REQUISITI){let e=0;hasAbility(characterInfo,i.REQUISITI)&&(e+=hasAbility(characterInfo,i.REQUISITI).LA),hasAbility(characterInfo,"INCANTESIMI AGGIUNTIVI ("+i.CLASSE.toUpperCase()+")")&&(e+=2),characterInfo.skills.filter(e=>e.REQUISITI==i.REQUISITI).length>=e&&(l=!0)}else"Eroica"!=i.TIPO||hasLevels(characterInfo,i.CLASSE)!=data.maxLv&&""!=i.CLASSE?l=!0:a&&(l=!0);if(!l){e.hasOwnProperty(i.CLASSE)||(e[i.CLASSE]=createClassHeader(i.CLASSE),n.appendChild(e[i.CLASSE])),t=e[i.CLASSE];let a=document.createElement("div");a.className="inRow";let l=fetchSvgIcon("angle-right");l.title="Aggiungi alla scheda";let o=buildAbility(i);function d(e){let t=hasAbility(characterInfo,this.passedSkill.NOME);t?characterInfo.skills[t].LA<Number(characterInfo.skills[t].MAX_LA)&&characterInfo.skills[t].LA++:(this.passedSkill.LA=1,characterInfo.skills.push(this.passedSkill)),updateSheet(),resetModalContent()}o.style.width="100%",a.appendChild(o),a.passedSkill=i,l.passedSkill=i,a.addEventListener("dblclick",d),l.addEventListener("click",d),a.appendChild(l),t.appendChild(a)}}),""!=n.innerHTML&&document.getElementById("availableAbilities").appendChild(n)}else document.getElementById("availableAbilities").innerHTML="<i style='margin:1em;'>Aggiungi una classe al personaggio per selezionare le abilita'.</i>"}function addWiki(){data.wiki.length>0?(data.wiki.forEach(function(e){let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");t.style.margin="0 0 0.5em 0",t.style.filter="brightness(0.9) grayscale(1)",n.className="compendiumHeader",n.style.fontSize="large",n.style.fontWeight="bold",n.style.fontStyle="italic",n.innerHTML=e.NOME,n.appendChild(expandIcon(!0,i)),i.innerHTML=e.DESCRIZIONE,i.style.display="none",i.style.padding="0.5em",i.style.textAlign="left",i.className="infoBlock",t.appendChild(n),t.appendChild(i),document.getElementById("wikiEntries").appendChild(t)}),document.getElementById("wikiEntries").parentNode.style.removeProperty("display")):document.getElementById("wikiEntries").parentNode.style.display="none"}function updateName(e,t){updateValue(e,t,"...",["name"])}function populateClass(e=null){let t=null;if(e instanceof HTMLElement){if(t=e.value,!characterInfo.levels[t]){characterInfo.levels[t]=1;let e=null;for(let n=0;n<data.abilities.length;n++)if(t==data.abilities[n].CLASSE&&"Beneficio"==data.abilities[n].TIPO){e=data.abilities[n];break}hasAbility(characterInfo,e.NOME)||characterInfo.skills.push(e)}updateSheet()}else{t=e.name;let n=document.createElement("div");n.className="classDetail",n.appendChild(fetchClassIcon(t));let i=document.createElement("span");i.innerHTML=t,n.appendChild(i);let a=document.createElement("input");a.id=t+"Lvl",a.type="number",a.min=1,a.max=data.maxLv,a.value=e.value,a.refClass=t,a.addEventListener("change",function(e){characterInfo.levels[e.target.refClass]=Number(e.target.value),updateSheet()}),n.appendChild(a);let l=fetchSvgIcon("times");l.refClass=t,l.addEventListener("click",removeClass),n.appendChild(l),document.getElementById("levelDetail").appendChild(n),document.getElementById("addNewClass").style.removeProperty("display")}}function removeClass(e,t=e.target.refClass){delete characterInfo.levels[t];for(let e=0;e<characterInfo.skills.length;e++)characterInfo.skills[e].CLASSE==t&&(characterInfo.skills.splice(e,1),e--);updateSheet()}function populateTrait(e,t){let n=null;e instanceof HTMLElement&&(n=e.value,characterInfo.traits[t.id]=n,t.innerHTML=""==n.trim()?"...":n)}function populateBond(e,t=null){let n=null,i=null;if(e instanceof HTMLElement?(n=e.value,i=e.bondRef):(n=e.name,i="bond_"+e.index),""!=n.trim()){let l=document.createElement("div");l.className="inRow";let o=0;function a(t,n,a){let l=document.createElement("select");l.id=i+"_"+n;let o=document.createElement("option"),d=document.createElement("option"),c=document.createElement("option");return o.value=0,d.value=1,c.value=2,o.text=a[0],d.text=a[1],c.text=a[2],l.appendChild(o),l.appendChild(d),l.appendChild(c),l.addEventListener("change",function(e){let t=e.target.id.split("_");characterInfo.bonds[t[1]].feelings[t[2]]=Number(e.target.value),updateSheet()}),e.feelings&&(l.selectedIndex=e.feelings[n]),l}characterInfo.bonds[e.index]&&(o=characterInfo.bonds[e.index].feelings.filter(e=>0!=e).length),l.innerHTML="<div>"+n+(o>0?" ["+o+"]":"")+"</div>",l.appendChild(a(0,0,["","Ammirazione","Inferiorita'"])),l.appendChild(a(0,1,["","Lealta'","Sfiducia"])),l.appendChild(a(0,2,["","Affetto","Odio"]));let d=fetchSvgIcon("times");if(d.bondRef=i,d.addEventListener("click",function(e){l.parentNode.removeChild(l),delete characterInfo.bonds[Number(e.target.bondRef.substr(5))]}),l.appendChild(d),!e.feelings){let e={name:n,feelings:[0,0,0]};characterInfo.bonds[Number(i.substr(5))]=e}t&&(t.innerHTML=""),document.getElementById("bondsList").appendChild(l)}}function sendInChat(e=""){let t=document.getElementById("textchat-input");return""==e&&(e=document.querySelectorAll("[lastDragged]")[0].textForChat?document.querySelectorAll("[lastDragged]")[0].textForChat.value:document.querySelectorAll("[lastDragged]")[0].querySelectorAll("[class='infoBlock']")[0].textForChat.value),t?(t.querySelectorAll("[title='Text Chat Input']")[0].value=e,t.querySelectorAll(".btn")[0].click(),null):sendMessage(e)}function buildContextMenu(e,t,n={}){let i=!1;if(n.hasOwnProperty("equipButton")?document.getElementById("contextMenu").querySelectorAll("[equipButton]").forEach(function(e){e.style.removeProperty("display"),i=!0}):document.getElementById("contextMenu").querySelectorAll("[equipButton]").forEach(function(e){e.style.display="none"}),n.hasOwnProperty("invManage")?document.getElementById("contextMenu").querySelectorAll("[invManage]").forEach(function(e){e.style.removeProperty("display"),i=!0}):document.getElementById("contextMenu").querySelectorAll("[invManage]").forEach(function(e){e.style.display="none"}),n.hasOwnProperty("directEquip")?document.getElementById("contextMenu").querySelectorAll("[directEquip]").forEach(function(e){e.style.removeProperty("display"),i=!0}):document.getElementById("contextMenu").querySelectorAll("[directEquip]").forEach(function(e){e.style.display="none"}),n.hasOwnProperty("containerMng")?document.getElementById("contextMenu").querySelectorAll("[containerMng]").forEach(function(e){e.style.removeProperty("display"),i=!0}):document.getElementById("contextMenu").querySelectorAll("[containerMng]").forEach(function(e){e.style.display="none"}),n.hasOwnProperty("chatInter")&&document.getElementById("contextMenu").querySelectorAll("[chatInter]").forEach(function(e){e.style.removeProperty("display"),i=!0}),!i)return;setModal("contextMenu"),e.setAttribute("lastDragged","x");let a=document.getElementById("contextMenu"),l=null;l=document.getElementById("FUToolkit")?document.getElementById("FUToolkit"):document.body,a.style.left=t[0]-Math.max(0,a.offsetWidth+t[0]-l.clientWidth)+"px",a.style.top=t[1]-Math.max(0,a.offsetHeight+t[1]-l.clientHeight)+"px"}function populateItem(e){let t=document.createElement("div");t.setAttribute("draggable","true"),t.associatedItem=e,t.className="item",t.addEventListener("dragstart",startEquip),t.addEventListener("contextmenu",function(e){buildContextMenu(this,[e.clientX,e.clientY],{chatInter:!0,equipButton:!0,invManage:!0,containerMng:!0}),e.preventDefault(e)});let n=document.createElement("div");n.classList.add("popupMenu");let i=fetchSvgIcon("edit");i.classList.add("editIcon"),i.refObj=e,i.addEventListener("click",function(e){openEditor(e.target.refObj,editCharSheet),setModal("editorFU")});let a=fetchSvgIcon("trash");if(a.classList.add("closeIcon"),a.itemToRemove=e,a.addEventListener("click",function(e){window.confirm("Confermi di voler cancellare questo oggetto?")&&(removeFromInventory(e.target.itemToRemove),updateSheet())}),e.equipped){let e=document.createElement("span");e.className="equipIcon",e.innerHTML="E",t.appendChild(e)}return t.appendChild(buildItemForSheet(e)),n.appendChild(i),n.appendChild(a),t.appendChild(n),t.addEventListener("dragenter",function(e){t.classList.add("onHover")}),t.addEventListener("dragleave",function(e){t.classList.contains("onHover")&&t.classList.remove("onHover")}),t.addEventListener("drop",dropItem),document.getElementById("inventoryList").appendChild(t),t}function dropItem(e){let t=characterInfo.inventory,n=document.querySelectorAll("[lastDragged]")[0],i=t.indexOf(n.associatedItem),a=null;"before"==e&&n.previousSibling?(a=n.previousSibling).parentNode.insertBefore(n,a):"after"==e&&n.nextSibling?(a=n.nextSibling,n.nextSibling.parentNode.insertBefore(a,n)):a=this;let l=t.indexOf(a.associatedItem);t.splice(l,0,n.associatedItem),t.splice(i+(l>i?0:1),1),n.associatedItem.container==a.associatedItem.container&&n.associatedItem.container||(n.associatedItem.container=a.associatedItem.container),n.removeAttribute("lastDragged")}function assignContainer(e,t,n){t&&(t.associatedItem.container==e&&t.associatedItem.container||(t.removeAttribute("lastDragged"),n.appendChild(t),t.associatedItem.container=e))}function populateSkill(e){let t=null;t=e.targetContainer?e.targetContainer:document.getElementById("abilityList");let n=buildAbilityForSheet(e);n.setAttribute("draggable","true"),n.className="ability";let i=document.createElement("div");if(i.classList.add("popupMenu"),"Beneficio"!=e.TIPO){if(n.refObj.LA<n.refObj.MAX_LA){let e=fetchSvgIcon("plus");e.classList.add("plusIcon"),e.refObj=n.refObj,e.addEventListener("click",function(e){n.refObj.LA++,updateSheet()}),i.appendChild(e)}let t=null;n.refObj.LA<=1?(t=fetchSvgIcon("trash")).addEventListener("click",function(e){window.confirm("Confermi di voler cancellare questa abilita'?")&&(removeSkill(e.target.skillToRemove.NOME),updateSheet())}):(t=fetchSvgIcon("minus")).addEventListener("click",function(e){removeSkill(e.target.skillToRemove.NOME),updateSheet()}),t.classList.add("closeIcon"),t.skillToRemove=e,i.appendChild(t)}let a=fetchSvgIcon("edit");return a.classList.add("editIcon"),a.refObj=n.refObj,a.addEventListener("click",function(e){openEditor(e.target.refObj,editCharSheet),setModal("editorFU")}),i.appendChild(a),n.appendChild(i),t.appendChild(n),n}function editLibrary(e){uploadEditorValues(e)?(alert("Entita' '"+e.refObj.NOME+"' modificata."),setLibraryToBeSaved(!0),populateEditorSelect()):alert("Nessuna modifica all'entita' '"+e.refObj.NOME+"' rilevata."),resetEditorMenu()}function resetEditorMenu(){document.getElementById("libraryEditor").innerHTML="<i style='margin:1em;'>Seleziona un'entita' per modificarla.</i>",document.getElementById("selectListToEdit").disabled=!1,document.getElementById("listToEdit").disabled=!1,document.getElementById("confirmObjectToEdit").innerHTML="Modifica"}function editCharSheet(e){uploadEditorValues(e),setModal(),updateSheet()}function removeSkill(e){for(let t=0;t<characterInfo.skills.length;t++)if(e===characterInfo.skills[t].NOME){if(characterInfo.skills[t].LA>1)characterInfo.skills[t].LA--;else{characterInfo.skills.splice(t,1);let n=0;for(;n<characterInfo.skills.length;)e==characterInfo.skills[n].REQUISITI?removeSkill(characterInfo.skills[n].NOME):n++}break}}function characterLevel(e){let t=0;return Object.keys(e.levels).forEach(function(n){t+=Number(e.levels[n])}),t}function calculateInitiative(e){let t=0+e.initMod;return Object.keys(e.equip).forEach(function(n){e.equip[n]&&(t+=Number(e.equip[n].MOD_INIZ))}),e.skills.forEach(function(e){t+=Number(e.MOD_INIZ)}),Object.keys(e.equip).forEach(function(n){if(e.equip[n]&&e.equip[n].AB_OGGETTO)for(let i=0;i<e.equip[n].AB_OGGETTO.length;i++){let a=data.abilities.filter(t=>t.NOME==e.equip[n].AB_OGGETTO[i].name)[0];t+=Number(a.MOD_INIZ)}}),t}function calculateDefense(e){let t=Number(document.getElementById("tempDes").value),n=null,i=e.pDefMod;return Object.keys(e.equip).forEach(function(t){e.equip[t]&&("BASE"==e.equip[t].TIPO_DIF?n=Number(e.equip[t].MOD_DIF):"MOD"==e.equip[t].TIPO_DIF&&(i+=Number(e.equip[t].MOD_DIF)))}),e.skills.forEach(function(e){i+=Number(e.MOD_DIF)}),Object.keys(e.equip).forEach(function(t){if(e.equip[t]&&e.equip[t].AB_OGGETTO)for(let n=0;n<e.equip[t].AB_OGGETTO.length;n++){let a=data.abilities.filter(i=>i.NOME==e.equip[t].AB_OGGETTO[n].name)[0];i+=Number(a.MOD_DIF)}}),(n||t)+i}function calculateMagicDefense(e){let t=Number(document.getElementById("tempInt").value),n=null,i=e.mDefMod;return Object.keys(e.equip).forEach(function(t){e.equip[t]&&("BASE"==e.equip[t].TIPO_DIF_MAG?n=Number(e.equip[t].MOD_DIFM):"MOD"==e.equip[t].TIPO_DIF_MAG&&(i+=Number(e.equip[t].MOD_DIFM)))}),e.skills.forEach(function(e){i+=Number(e.MOD_DIFM)}),Object.keys(e.equip).forEach(function(t){if(e.equip[t]&&e.equip[t].AB_OGGETTO)for(let n=0;n<e.equip[t].AB_OGGETTO.length;n++){let a=data.abilities.filter(i=>i.NOME==e.equip[t].AB_OGGETTO[n].name)[0];i+=Number(a.MOD_DIFM)}}),(n||t)+i}function maxHp(e){let t=characterLevel(e)+5*e.vig.base,n=0;e.skills.forEach(function(t){if(-1==t.MOD_PV.indexOf("|"))n+=Number(t.MOD_PV)*(t.LA?t.LA:1);else{let i=t.MOD_PV.split("|");characterLevel(e)>=Number(i[0].split(":")[0])?n+=Number(i[1])*(t.LA?t.LA:1):n+=Number(i[0].split(":")[1])*(t.LA?t.LA:1)}});let i=0;return Object.keys(e.equip).forEach(function(t){if(e.equip[t]&&e.equip[t].AB_OGGETTO)for(let n=0;n<e.equip[t].AB_OGGETTO.length;n++){let a=data.abilities.filter(i=>i.NOME==e.equip[t].AB_OGGETTO[n].name)[0];if(-1==a.MOD_PV.indexOf("|"))i+=Number(a.MOD_PV)*(a.LA?a.LA:1);else{let t=a.MOD_PV.split("|");characterLevel(e)>=Number(t[0].split(":")[0])?i+=Number(t[1])*(a.LA?a.LA:1):i+=Number(t[0].split(":")[1])*(a.LA?a.LA:1)}}}),t+=n+i}function maxMp(e){let t=characterLevel(e)+5*e.vol.base,n=0;e.skills.forEach(function(t){if(-1==t.MOD_PM.indexOf("|"))n+=Number(t.MOD_PM)*(t.LA?t.LA:1);else{let i=t.MOD_PM.split("|");characterLevel(e)>=Number(i[0].split(":")[0])?n+=Number(i[1])*(t.LA?t.LA:1):n+=Number(i[0].split(":")[1])*(t.LA?t.LA:1)}});return Object.keys(e.equip).forEach(function(t){if(e.equip[t]&&e.equip[t].AB_OGGETTO)for(let i=0;i<e.equip[t].AB_OGGETTO.length;i++){let a=data.abilities.filter(n=>n.NOME==e.equip[t].AB_OGGETTO[i].name)[0];if(-1==a.MOD_PM.indexOf("|"))n+=Number(a.MOD_PM)*(a.LA?a.LA:1);else{let t=a.MOD_PM.split("|");characterLevel(e)>=Number(t[0].split(":")[0])?n+=Number(t[1])*(a.LA?a.LA:1):n+=Number(t[0].split(":")[1])*(a.LA?a.LA:1)}}}),t+=n+0}function maxIp(e){let t=6+e.ip.mod,n=0;e.skills.forEach(function(t){if(-1==t.MOD_PI.indexOf("|"))n+=Number(t.MOD_PI)*(t.LA?t.LA:1);else{let i=t.MOD_PI.split("|");characterLevel(e)>=Number(i[0].split(":")[0])?n+=Number(i[1])*(t.LA?t.LA:1):n+=Number(i[0].split(":")[1])*(t.LA?t.LA:1)}});return Object.keys(e.equip).forEach(function(t){if(e.equip[t]&&e.equip[t].AB_OGGETTO)for(let i=0;i<e.equip[t].AB_OGGETTO.length;i++){let a=data.abilities.filter(n=>n.NOME==e.equip[t].AB_OGGETTO[i].name)[0];if(-1==a.MOD_PI.indexOf("|"))n+=Number(a.MOD_PI)*(a.LA?a.LA:1);else{let t=a.MOD_PI.split("|");characterLevel(e)>=Number(t[0].split(":")[0])?n+=Number(t[1])*(a.LA?a.LA:1):n+=Number(t[0].split(":")[1])*(a.LA?a.LA:1)}}}),t+=n+0}function hasAbility(e,t){for(let n=0;n<e.skills.length;n++)if(e.skills[n].NOME==t)return n;return!1}function hasLevels(e,t){return!!e.levels[t]&&e.levels[t]}function hasCompetency(e){let t=!0;return"M"==e.MARZIALE&&(("Mischia"!=e.RAGGIO||characterInfo.martial.melee)&&("Distanza"!=e.RAGGIO||characterInfo.martial.range)&&("Armatura"!=e.CATEGORIA||characterInfo.martial.armor)&&("Scudo"!=e.CATEGORIA||characterInfo.martial.shield)||(t=!1)),t}function updateScore(e,t){return e.current=Math.max(0,Math.min(Number(t),e.max?Number(e.max)+Number(e.mod):1/0)),checkOnCrisis(),e.current}function refreshTracker(e,t){updateScore(e.refObj,t),e.viewer.innerHTML=e.refObj.current,e.input.value=e.refObj.current,shareClocks()}function gainScore(e,t=null){let n=characterInfo[e];t?updateScore(n,Number(n.current)+t):n.max&&updateScore(n,Number.POSITIVE_INFINITY),updateSheet()}function heal(){gainScore("hp")}function refresh(){gainScore("mp")}function checkOnCrisis(){characterInfo.hp.current<=Math.floor(characterInfo.hp.max/2)&&characterInfo.hp.current>0?document.getElementById("heart").classList.add("crisisIcon"):document.getElementById("heart").classList.contains("crisisIcon")&&document.getElementById("heart").classList.remove("crisisIcon")}function getTotalEffectiveStat(e){let t=0,n=characterInfo[e].temp;return"des"===e?t=(characterInfo.status.slow?2:0)+(characterInfo.status.enraged?2:0):"int"===e?t=(characterInfo.status.confused?2:0)+(characterInfo.status.enraged?2:0):"vig"===e?t=(characterInfo.status.weak?2:0)+(characterInfo.status.poisoned?2:0):"vol"===e&&(t=(characterInfo.status.shaken?2:0)+(characterInfo.status.poisoned?2:0)),t>0&&20==characterInfo[e].temp&&(n=14),Math.max(6,n-t)}function addItemAbilities(e){let t=[];if(e.AB_OGGETTO)for(let n=0;n<e.AB_OGGETTO.length;n++)if((t=data.abilities.filter(t=>t.NOME==e.AB_OGGETTO[n].name)).length>0){let i=JSON.parse(JSON.stringify(t[0]));i.LA=e.AB_OGGETTO[n].la,document.getElementById("equipAbilities").appendChild(buildAbilityForSheet(i))}}function updateSheet(e=characterInfo){e.autosave&&saveCharacter(!0),""!=characterInfo.sheetColor?editPalette():editPalette("#fddc71"),document.getElementById("addNewClass").style.removeProperty("display"),document.getElementById("name").innerHTML=e.name,document.getElementById("charTotLevel").innerHTML=characterLevel(e);const t=document.getElementById("addNewClass");document.getElementById("levelDetail").innerHTML="",document.getElementById("levelDetail").append(t),Object.keys(e.levels).forEach(function(t){let n={};n.name=t,n.value=e.levels[t],populateClass(n)}),document.getElementById("baseDes").value=e.des.base,document.getElementById("baseInt").value=e.int.base,document.getElementById("baseVig").value=e.vig.base,document.getElementById("baseVol").value=e.vol.base,Object.keys(e.status).forEach(function(t){document.getElementById(t).checked=e.status[t]}),document.getElementById("tempDes").value=getTotalEffectiveStat("des"),document.getElementById("tempInt").value=getTotalEffectiveStat("int"),document.getElementById("tempVig").value=getTotalEffectiveStat("vig"),document.getElementById("tempVol").value=getTotalEffectiveStat("vol"),document.getElementById("identity").innerHTML=e.traits.identity,document.getElementById("theme").innerHTML=e.traits.theme,document.getElementById("origin").innerHTML=e.traits.origin,document.getElementById("bondsList").innerHTML="";let n=0;for(;n<e.bonds.length;)e.bonds[n]?n++:e.bonds.splice(n,1);e.bonds.forEach(function(e,t){e.index=t,populateBond(e)}),document.getElementById("inventoryList").innerHTML="",document.getElementById("contextMenu").querySelectorAll("[containerMng]").forEach(function(e){e.parentNode.removeChild(e)}),hasAbility(characterInfo,"ALLA MODA")?(document.getElementById("accessory2").style.removeProperty("display"),document.getElementById("contextMenu").children[5].children[0].style.removeProperty("display")):(document.getElementById("accessory2").style.display="none",document.getElementById("contextMenu").children[5].children[0].display="none",unequip("bonusAccessory",!1)),e.inventory.forEach(function(t){let n=populateItem(t);if(t.equipped&&(e.equip[t.equipped]=t),t.container){let e=document.querySelectorAll("[containerName='"+t.container+"']"),i=null;(i=0==e.length?addInventoryContainer(t.container):e[0]).appendChild(n)}}),e.equip.main||(e.equip.main=JSON.parse(JSON.stringify(data.default[0]))),document.getElementById("equipAbilities").innerHTML="",document.getElementById("mainHand").innerHTML="",document.getElementById("mainHand").appendChild(buildItemForSheet(e.equip.main)),addItemAbilities(e.equip.main),document.getElementById("secondaryHand").innerHTML="",e.equip.secondary?(document.getElementById("secondaryHand").appendChild(buildItemForSheet(e.equip.secondary)),document.getElementById("removeSecondary").style.removeProperty("display"),addItemAbilities(e.equip.secondary)):(document.getElementById("secondaryHand").innerHTML="Nessuna",document.getElementById("removeSecondary").style.display="none"),e.equip.armor||(e.equip.armor=JSON.parse(JSON.stringify(data.default[1]))),document.getElementById("armor").innerHTML="",document.getElementById("armor").appendChild(buildItemForSheet(e.equip.armor)),addItemAbilities(e.equip.armor),e.equip.accessory?(document.getElementById("accessory").innerHTML="",document.getElementById("accessory").appendChild(buildItemForSheet(e.equip.accessory)),document.getElementById("removeAccessory").style.removeProperty("display"),addItemAbilities(e.equip.accessory)):(document.getElementById("accessory").innerHTML="Nessuno",document.getElementById("removeAccessory").style.display="none"),e.equip.bonusAccessory?(document.getElementById("bonusAccessory").innerHTML="",document.getElementById("bonusAccessory").appendChild(buildItemForSheet(e.equip.bonusAccessory)),document.getElementById("removeBonusAccessory").style.removeProperty("display"),addItemAbilities(e.equip.bonusAccessory)):(document.getElementById("bonusAccessory").innerHTML="Nessuno",document.getElementById("removeBonusAccessory").style.display="none"),""!=document.getElementById("equipAbilities").innerHTML?document.getElementById("equipAb").style.removeProperty("display"):document.getElementById("equipAb").style.display="none",document.getElementById("noteList").innerHTML="",e.notes.forEach(function(e){addNewNote(e)}),Object.keys(e.peculiarity).forEach(t=>{document.getElementById(t).innerHTML=e.peculiarity[t]}),Object.keys(e.zeroPower).forEach(t=>{document.getElementById(t).innerHTML=e.zeroPower[t]}),document.getElementById("zeroClock").innerHTML="",document.getElementById("zeroClock").appendChild(zeroPowerClock()),e.hp.max=maxHp(e),e.mp.max=maxMp(e),e.ip.max=maxIp(e),document.getElementById("ip").max=e.ip.max,document.getElementById("ip_max").innerHTML="Max PI: <span>"+e.ip.max+"</span>",document.getElementById("ip").value=e.ip.current,document.getElementById("zenit").value=e.zenit.current,document.getElementById("scores").innerHTML="",document.getElementById("scores").appendChild(createTracker("fabula")),document.getElementById("scores").appendChild(createTracker("hp")),document.getElementById("scores").appendChild(createTracker("mp")),checkOnCrisis(),document.getElementById("initiative").innerHTML=calculateInitiative(e),document.getElementById("defense").innerHTML=calculateDefense(e),document.getElementById("magDefense").innerHTML=calculateMagicDefense(e);let i={},a="";if(refreshProfileImage(),e.skills){document.getElementById("abilityList").innerHTML="",document.getElementById("spellList").innerHTML="";let t={},n={};e.martial={melee:!1,range:!1,armor:!1,shield:!1},e.skills.forEach(function(a){""==a.CAPACITA?(t.hasOwnProperty(a.CLASSE)||(t[a.CLASSE]=createClassHeader(a.CLASSE),document.getElementById("abilityList").appendChild(t[a.CLASSE])),a.targetContainer=t[a.CLASSE],i[a.CLASSE]?i[a.CLASSE]+=a.LA:i[a.CLASSE]=a.LA):(n.hasOwnProperty(a.CLASSE)||(n[a.CLASSE]=createClassHeader(a.CLASSE),document.getElementById("spellList").appendChild(n[a.CLASSE])),a.targetContainer=n[a.CLASSE]),"1"==a.COMP_MIS&&(e.martial.melee=!0),"1"==a.COMP_DIS&&(e.martial.range=!0),"1"==a.COMP_ARM&&(e.martial.armor=!0),"1"==a.COMP_SCU&&(e.martial.shield=!0),populateSkill(a)}),Object.keys(e.equip).forEach(function(t){if(e.equip[t]&&e.equip[t].AB_OGGETTO)for(let n=0;n<e.equip[t].AB_OGGETTO.length;n++){let i=data.abilities.filter(i=>i.NOME==e.equip[t].AB_OGGETTO[n].name)[0];"1"==i.COMP_MIS&&(e.martial.melee=!0),"1"==i.COMP_DIS&&(e.martial.range=!0),"1"==i.COMP_ARM&&(e.martial.armor=!0),"1"==i.COMP_SCU&&(e.martial.shield=!0)}}),Object.keys(e.levels).forEach(function(t){let n=0;i[t]&&(n=i[t]),e.levels[t]>n&&(""==a?a="Mancano da selezionare abilita': ":a+=", ",a+=t+": "+(e.levels[t]-n)+" punti"),e.levels[t]<n&&(""==a?a="Skill in eccesso per: ":a+=", ",a+=t+": "+(n-e.levels[t])+" punti")}),document.getElementById("memoAbilities").innerHTML=a}}function createClassHeader(e){let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("span");return n.appendChild(fetchClassIcon(e)),n.className="inRow",i.innerHTML=e,n.appendChild(i),t.appendChild(n),t.setAttribute("categoryWrapper","skill"),t}function createItemHeader(e){let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("span");return n.className="inRow",i.innerHTML=e,n.appendChild(i),t.appendChild(n),t.setAttribute("categoryWrapper","item"),t}function allowDrop(e){e.preventDefault()}function startEquip(e){let t=document.querySelectorAll("[lastDragged]");for(let e=0;e<t.length;e++)t[e].removeAttribute("lastDragged"),t[e].classList.contains("equipDenied")&&t[e].classList.remove("equipDenied");e.target.setAttribute("lastDragged","x")}function switchContextListPage(e){buildItemContextList(document.getElementById("listForEquip").getAttribute("slot"),Number(document.getElementById("listForEquip").getAttribute("lotPage"))+e)}function buildItemContextList(e,t=0){let n=getEquippableItemsList(e);if(0==n.length)document.getElementById("listForEquip").removeAttribute("slot"),document.getElementById("listForEquip").removeAttribute("lotPage"),document.getElementById("listForEquip").style.display="none",document.getElementById("backItems").style.display="none",document.getElementById("forwardItems").style.display="none",document.getElementById("listForEquip").parentNode.firstElementChild.style.display="none";else{document.getElementById("listForEquip").setAttribute("slot",e),document.getElementById("listForEquip").setAttribute("lotPage",t),document.getElementById("listForEquip").style.removeProperty("display"),document.getElementById("backItems").style.removeProperty("display"),document.getElementById("forwardItems").style.removeProperty("display"),document.getElementById("listForEquip").parentNode.firstElementChild.style.removeProperty("display"),document.getElementById("listForEquip").innerHTML="";let i=4,a=Math.min(n.length,i*(Math.max(0,t)+1)),l=Math.min(i*Math.max(0,t),a);for(let t=l;t<a;t++){let i=document.createElement("span");i.className="interactable",i.innerHTML=n[t].NOME,i.prepend(fetchItemIcon(n[t].NOME)),i.refObj=n[t],i.addEventListener("click",()=>{equip(e,i.refObj),setModal()}),document.getElementById("listForEquip").appendChild(i)}l>0?document.getElementById("backItems").style.removeProperty("visibility"):document.getElementById("backItems").style.visibility="hidden",a==n.length?document.getElementById("forwardItems").style.visibility="hidden":document.getElementById("forwardItems").style.removeProperty("visibility")}}function getEquippableItemsList(e){return characterInfo.inventory.filter(t=>!0===checkEquippable(e,t))}function checkEquippable(e,t){if(!hasCompetency(t))return!1;if("armor"==e){if("Corpo"==t.MANI&&"Armatura"==t.CATEGORIA)return!0}else if("accessory"==e||"bonusAccessory"==e){if("Corpo"==t.MANI&&"Accessorio"==t.CATEGORIA)return!0}else{if("secondaryHand"==e||"secondary"==e){let e=!1;return"Sec"==t.MANI?e=!0:"Due"==t.MANI&&hasAbility(characterInfo,"STRETTA DELLA SCIMMIA")&&["Flagello","Lancia","Pesante","Spada"].includes(t.CATEGORIA)?hasAbility(characterInfo,"AMBIDESTRISMO")?"Due"==characterInfo.equip.main.MANI?["Flagello","Lancia","Pesante","Spada"].includes(characterInfo.equip.main.CATEGORIA)&&(e=!0):e=!0:t.CATEGORIA==characterInfo.equip.main.CATEGORIA&&(e=!0):"Una"==t.MANI&&characterInfo.equip.main&&("Due"==characterInfo.equip.main.MANI?hasAbility(characterInfo,"STRETTA DELLA SCIMMIA")&&(hasAbility(characterInfo,"AMBIDESTRISMO")?["Flagello","Lancia","Pesante","Spada"].includes(characterInfo.equip.main.CATEGORIA)&&(e=!0):t.CATEGORIA==characterInfo.equip.main.CATEGORIA&&(e=!0)):hasAbility(characterInfo,"AMBIDESTRISMO")?e=!0:t.CATEGORIA==characterInfo.equip.main.CATEGORIA&&(e=!0)),e}if(("mainHand"==e||"main"==e)&&("Una"==t.MANI||"Due"==t.MANI||"Sec"==t.MANI&&hasAbility(characterInfo,"DOPPIO SCUDO")))return!0}}function equip(e,t=null){let n=null,i=null;if(i=t||document.querySelectorAll("[lastDragged]")[0].associatedItem,checkEquippable(n=e.indexOf("Hand")>-1?e.replace("Hand",""):e,i)){if(unequip(n,!1),unequipWithItem(i),characterInfo.equip[n]=i,i.equipped=n,"mainHand"==n||"main"==n)if("Una"==i.MANI)characterInfo.equip.secondary&&(i.CATEGORIA==characterInfo.equip.secondary.CATEGORIA||hasAbility(characterInfo,"AMBIDESTRISMO")||"Sec"==characterInfo.equip.secondary.MANI||unequip("secondary",!1));else if("Due"==i.MANI&&characterInfo.equip.secondary){let e=!0;hasAbility(characterInfo,"STRETTA DELLA SCIMMIA")&&["Flagello","Lancia","Pesante","Spada"].includes(i.CATEGORIA)&&(hasAbility(characterInfo,"AMBIDESTRISMO")?["Flagello","Lancia","Pesante","Spada"].includes(characterInfo.equip.secondary.CATEGORIA)&&(e=!1):i.CATEGORIA==characterInfo.equip.secondary.CATEGORIA&&(e=!1)),e&&unequip("secondary",!1)}updateSheet()}else document.querySelectorAll("[lastDragged]")[0].classList.add("equipDenied")}function unequip(e,t=!0){let n=null;n=e.target?e.target.slot:e,characterInfo.equip[n]&&characterInfo.equip[n].equipped&&delete characterInfo.equip[n].equipped,characterInfo.equip[n]=null,t&&updateSheet()}function unequipWithItem(e){e.equipped&&unequip(e.equipped,!1)}function removeFromInventory(e){unequipWithItem(e);for(let t=0;t<characterInfo.inventory.length;t++)if(e===characterInfo.inventory[t]){characterInfo.inventory.splice(t,1);break}}function addInventoryContainer(e=null){let t=document.createElement("div");t.className="itemContainer",t.style.borderWidth="3px";let n=document.createElement("div"),i=document.createElement("div");i.style.display="none";let a=document.createElement("div");a.classList.add("popupContainer");let l=fetchSvgIcon("backspace");if(l.refObj=i,l.addEventListener("click",function(e){if(window.confirm("Si � sicuri di voler svuotare completamente il contenitore e cancellarlo?")){for(let t=0;t<e.target.refObj.children.length;t++)delete e.target.refObj.children[t].associatedItem.container;updateSheet()}}),a.appendChild(l),t.appendChild(a),t.appendChild(n),t.appendChild(i),t.addEventListener("dragover",function(e){e.preventDefault()}),document.getElementById("inventoryList").prepend(t),e)renameItemContainer(e,n,i);else{let e=createTextInput(function(t){renameItemContainer(e[0].value,n,i)});n.appendChild(e[0]),n.appendChild(e[1]),e[0].removeAttribute("newInput")}return i.setAttribute("containerName",e),i}function addNewNote(e=null){let t=document.createElement("div");t.className="item",t.style.borderWidth="3px";let n=document.createElement("div");n.className="inRow";let i=document.createElement("div");if(i.className="itemContainer",i.style.flexDirection="column",i.style.display="none",t.appendChild(n),t.appendChild(i),null==e){let e=createTextInput(function(t){characterInfo.notes.push({title:e[0].value,content:""}),updateSheet()});n.appendChild(e[0]),n.appendChild(e[1])}else{t.refObj=e;let a=document.createElement("div");a.innerHTML=e.title,a.addEventListener("dblclick",function(t){let i=a.innerHTML;n.innerHTML="";let l=createTextInput(function(t){e.title=l[0].value,updateSheet()},updateSheet);l[0].value=i,l[0].removeAttribute("newInput"),n.appendChild(l[0]),n.appendChild(l[1])}),n.appendChild(a);let l=document.createElement("div");l.appendChild(expandIcon(!0,i)),n.appendChild(l);let o=document.createElement("textarea");o.addEventListener("input",function(t){this.style.height="",this.style.height=Math.max(Math.min(200,o.scrollHeight),100)+"px",e.content=this.value,characterInfo.autosave&&saveCharacter(!0)}),o.style.width="100%",o.style.height=Math.max(Math.min(200,o.scrollHeight),100)+"px",o.style.resize="vertical",o.style.overflow="auto",o.innerHTML=e.content,i.appendChild(o);let d=document.createElement("div");d.classList.add("popupMenu");let c=null;(c=fetchSvgIcon("trash")).addEventListener("click",function(t){window.confirm("Confermi di voler cancellare questa nota?")&&(characterInfo.notes.splice(characterInfo.notes.indexOf(e),1),updateSheet())}),c.classList.add("closeIcon"),d.appendChild(c),t.appendChild(d)}document.getElementById("noteList").appendChild(t)}function renameItemContainer(e,t,n){if(""!=e.trim()&&0==document.querySelectorAll('[containerName="'+e+'"]').length){let i=fetchSvgIcon("box");i.style.margin="5px";let a=document.createElement("div");a.style.margin="auto",a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.innerHTML=e,n.setAttribute("containerName",e),a.addEventListener("dblclick",function(e){let i=t.textContent;t.innerHTML="";let a=createTextInput(function(e){for(let e=0;e<n.children.length;e++)n.children[e].associatedItem.container=a[0].value;renameItemContainer(a[0].value,t,n)},updateSheet);a[0].value=i,a[0].removeAttribute("newInput"),t.appendChild(a[0]),t.appendChild(a[1])}),n.parentNode.removeEventListener("drop",assignContainer),n.parentNode.addEventListener("drop",function(t){assignContainer(e,document.querySelectorAll("[lastDragged]")[0],n)});let l=document.createElement("div");l.innerHTML="<span>Sposta in '"+e+"'</span>",l.setAttribute("containerMng",""),l.addEventListener("click",function(t){assignContainer(e,document.querySelectorAll("[lastDragged]")[0],n),setModal()}),document.getElementById("contextMenu").appendChild(l),t.innerHTML="",a.prepend(i),t.appendChild(a),t.appendChild(expandIcon())}}function expandIcon(e=!0,t=null){let n=fetchSvgIcon("chevron-down");return e||(n.style.transform="rotate(180deg)"),n.addEventListener("click",function(e){let n=null;"none"==(n=t||e.target.parentNode.nextElementSibling).style.display?(n.style.removeProperty("display"),e.target.style.transform="rotate(180deg)"):(n.style.display="none",e.target.style.transform="rotate(0deg)")}),n}function buildItem(e){let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");n.appendChild(fetchItemIcon(e.NOME));let a=document.createElement("span");a.innerHTML=e.NOME,n.appendChild(a),n.appendChild(expandIcon(!0,i)),n.style.display="flex",n.style.alignItems="center",i.innerHTML="";let l=""!=e.MARZIALE?"[<span style='color: transparent;text-shadow: 0 0 0 "+(hasCompetency(e)?"black":"red")+";'>🛡️</span>]":"";return"Armatura"==e.CATEGORIA||"Scudo"==e.CATEGORIA?(i.innerHTML+="<div style='border-bottom: solid 1px black;'>"+e.CATEGORIA+l+" - "+e.COSTO+"Z</div>",i.innerHTML+="<div>Difesa: "+("BASE"!=e.TIPO_DIF&&"-"!=e.MOD_DIF.charAt(0)?"+":"")+e.MOD_DIF+", Dif. Magica: "+("BASE"!=e.TIPO_DIF&&"-"!=e.MOD_DIFM.charAt(0)?"+":"")+e.MOD_DIFM+", Iniziativa: "+e.MOD_INIZ+"</div>"):"Accessorio"!=e.CATEGORIA&&(i.innerHTML+="<div style='border-bottom: solid 1px black;'>"+e.CATEGORIA+" ("+e.RAGGIO+")"+l+", Mani: "+e.MANI+" - "+e.COSTO+"Z</div>",i.innerHTML+="<div class='inRow' style='border-bottom: solid 1px black;'><span class='interactable'>TP: <span class='tp'>"+e.PRECISIONE+"</span></span><span class='interactable'><span class='td'>"+e.DANNO+"</span> "+e.TIPO_DANNO+"</span></div>"),i.innerHTML+="<div>Qualita': "+encodeHTML(e.QUALITA)+"</div>",i.style.display="none",i.style.flexDirection="column",i.className="infoBlock",i.textForChat={get value(){let t="\n**"+e.NOME+"**";for(let e=0;e<i.children.length;e++)t+="\n"+i.children[e].textContent;return t}},t.refObj=e,t.appendChild(n),t.appendChild(i),t.className="item",t.slot=e,t}function buildItemForSheet(e){let t=buildItem(e);return applySpecialNotation(t),t}function buildAbility(e){let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");n.innerHTML=("Eroica"==e.TIPO?"[Eroica] ":"")+("Incantesimo"==e.TIPO?"Incantesimo: ":"")+("x"==e.OFFENSIVO?"[⚡] ":"")+e.NOME,n.appendChild(expandIcon(!0,i)),n.style.display="flex",n.style.alignItems="center",i.innerHTML="",i.innerHTML+="<div style='border-bottom: solid 1px black;'> "+(Number(e.MAX_LA)>1?"LA massimo: "+e.MAX_LA+(e.LA?", LA attuale: "+e.LA:""):"")+"</div>";let a="";return""!=e.COSTO.trim()&&(a+="Costo: "+e.COSTO+", "),""!=e.BERSAGLIO.trim()&&(a+=""!=a?", ":"",a+="Bersaglio: "+e.BERSAGLIO+", "),""!=e.DURATA.trim()&&(a+=""!=a?", ":"",a+="Durata: "+e.DURATA),""!=a&&(i.innerHTML+="<div style='border-bottom: solid 1px black;'>",i.innerHTML+=a,i.innerHTML+="</div>"),""!=e.REQUISITI&&(i.innerHTML+="<div style='border-bottom: solid 1px black;'>Requisiti: "+e.REQUISITI+"</div>"),i.innerHTML+="<div> "+encodeHTML(e.TESTO)+"</div>",i.style.display="none",i.style.flexDirection="column",i.className="infoBlock",i.textForChat={get value(){let e="\n**"+n.textContent+"**";for(let t=0;t<i.children.length;t++)e+="\n"+i.children[t].textContent;return e}},t.refObj=e,t.appendChild(n),t.appendChild(i),t.className="ability",t}function buildAbilityForSheet(e){let t=buildAbility(e);return applySpecialNotation(t),t.addEventListener("contextmenu",function(e){buildContextMenu(this,[e.clientX,e.clientY],{chatInter:!0}),e.preventDefault(e)}),t}function applySpecialNotation(e){for(let t of e.getElementsByClassName("tp")){let e=t.textContent.replace("[","").replace("]","|").split("|")[0].split("+");t.popupContent="<span class='tip'>[d"+getTotalEffectiveStat(e[0].trim().toLowerCase())+" + d"+getTotalEffectiveStat(e[1].trim().toLowerCase())+"]",t.textContent.split("]").length>1&&(t.popupContent+=t.textContent.split("]")[1].trim()),t.popupContent+="</span>",t.addEventListener("click",showPopup)}for(let t of e.getElementsByClassName("td"));for(let t of e.getElementsByClassName("la"))e.refObj.LA&&(t.innerHTML=t.innerHTML.replace("LA","<span style='color:green;font-weight:bolder'>"+e.refObj.LA+"</span>"))}function fetchItemIcon(e){return fetchIcon(e,"items")}function fetchClassIcon(e){return fetchIcon(e,"classes")}function fetchSvgIcon(e){return fetchIcon(e,"svg","svg")}function fetchIcon(e,t,n="jpg"){let i=document.createElement("img");if(i.className="icon",i.src=fallbackImgB64,"svg"==n)systemData.svg[e]?i.src="data:image/svg+xml;charset=UTF-8,"+systemData.svg[e]:i.src=fallbackImgB64,i.className="falt",i.draggable=!1,i.addEventListener("mousedown",async function(){i.classList.add("clicked"),await sleep(100),i.classList.remove("clicked")});else{let n=data.img[t][Object.keys(data.img[t]).find(t=>t.toLowerCase()===e.toLowerCase())];i.src=n||fallbackImgB64}return i}function setModal(e="compendiumFU"){if("none"!=document.getElementById("popup").style.display&&(document.getElementById("popup").style.display="none",document.getElementById("rollResult")&&(document.getElementById("rollResult").innerHTML="")),"none"==document.getElementById("modalBckgr").style.display)"compendiumFU"==e&&resetModalContent(),document.getElementById("modalBckgr").style.removeProperty("display"),document.getElementById(e).style.removeProperty("display");else{let e=document.querySelectorAll("[modal]");for(let t=0;t<e.length;t++)e[t].style.display="none"}document.querySelectorAll("[lastDragged]").length>0&&document.querySelectorAll("[lastDragged]")[0].removeAttribute("lastDragged")}function resetModalContent(){let e=document.getElementById("availableItems").firstElementChild;document.getElementById("availableItems").innerHTML="",document.getElementById("availableAbilities").innerHTML="",document.getElementById("wikiEntries").innerHTML="",document.getElementById("availableItems").appendChild(e),addItem(),addSkill(),addWiki(),applyItemFilter()}function createRelatedNumberInput(e=null){let t=document.createElement("input");return t.type="number",t.min="1",e?(t.max=e.max,t.value=Math.min(e.la,t.max)):t.value=1,t}function generateListOptions(e,t=null){let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="row",n.style.alignItems="center",n.style.justifyContent="center";let i=document.createElement("select");i.style.maxWidth="50%";let a=document.createElement("option"),l=fetchSvgIcon("trash");return l.addEventListener("click",function(e){l.parentNode.parentNode.removeChild(l.parentNode)}),data[e].forEach(function(e){let t=a.cloneNode();t.value=e.NOME,t.text=e.NOME,i.appendChild(t)}),t?(i.value=t.name,i.refInput=createRelatedNumberInput(t)):i.refInput=createRelatedNumberInput({name:i[0].value,la:1,max:data[e].filter(e=>e.NOME==i[0].value)[0].MAX_LA}),i.addEventListener("change",function(t){let n=createRelatedNumberInput({name:i.value,la:i.refInput.value,max:data[e].filter(e=>e.NOME==i.value)[0].MAX_LA});i.refInput.parentNode.insertBefore(n,i.refInput),i.refInput.parentNode.removeChild(i.refInput),i.refInput=n}),n.appendChild(i),n.appendChild(i.refInput),n.appendChild(l),n}function openEditor(e,t,n=null){let i=document.createElement("div");i.style.position="relative",i.style.margin="auto",i.style.maxWidth="80%";let a=null;e.hasOwnProperty("EDITOR")?a=data.editorTags[e.EDITOR]:e.RARITA?a=data.editorTags.OGGETTO:""==e.CLASSE||e.CLASSE?a=data.editorTags.ABILITA:e.DESCRIZIONE&&(a=data.editorTags.WIKI),null===a&&(i.descriptionRefs=e,e={NOME:i.descriptionRefs.arr[i.descriptionRefs.idx]},a={NOME:{label:"Nome",tag:"input",inputType:"text"}}),i.refObj=e,Object.keys(a).forEach(function(t){if(a.hasOwnProperty(t)){let n=a[t],l=document.createElement("div");l.className="elementBits";let o=document.createElement("span");o.innerHTML=n.label;let d=null;if(d="list"==n.tag?document.createElement("div"):document.createElement(n.tag),"select"==n.tag){let e=document.createElement("option");n.values.forEach(function(t){let n=e.cloneNode();n.value=t,n.text=t,d.appendChild(n)})}else if("input"==n.tag)d.type=n.inputType;else if("textarea"==n.tag)d.style.height="10em",d.style.width="100%",d.style.resize="none";else if("list"==n.tag){d.style.display="flex",d.style.flexDirection="column";let i=fetchSvgIcon("plus");if(i.list=n.values,i.style.width="100%",i.addEventListener("click",function(e){i.parentNode.appendChild(generateListOptions(i.list))}),d.appendChild(i),e[t]){let n=0,a=Number.POSITIVE_INFINITY;e.MAX_AB_OGGETTO&&(a=Number(e.MAX_AB_OGGETTO)),e[t].forEach(function(e){e.max=data.abilities.filter(t=>t.NOME==e.name)[0].MAX_LA,a>n&&(e.max=Math.min(a-n,e.la),e.la=Math.min(e.la,e.max),n+=e.max,i.parentNode.appendChild(generateListOptions(i.list,e)))})}}"list"!=n.tag&&(d.value=e[t]),d.setAttribute("property",t),d.propType=n.tag,l.appendChild(o),l.appendChild(d),i.appendChild(l)}});let l=document.createElement("div");l.className="button",l.innerHTML="Salva",l.style.position="relative",l.addEventListener("click",function(e){t(i)}),null==n&&(n=document.getElementById("editorContent")),n.innerHTML="",n.appendChild(i),n.prepend(l)}function uploadEditorValues(e){let t=e.refObj,n=!1;if(e.querySelectorAll("[property]").forEach(function(i){if(e.descriptionRefs)i.value!==e.descriptionRefs.arr[e.descriptionRefs.idx]&&(e.descriptionRefs.arr[e.descriptionRefs.idx]=i.value,n=!0);else if("list"==i.propType){let e=[];for(let t=0;t<i.querySelectorAll("select").length;t++)e.push({name:i.querySelectorAll("select")[t].value,la:i.querySelectorAll("select")[t].refInput.value});t[i.getAttribute("property")]!=e&&(t[i.getAttribute("property")]=e,n=!0),console.log(e)}else t[i.getAttribute("property")]!==i.value&&(n=!0),t[i.getAttribute("property")]=i.value}),document.getElementById("newImgPreview")){let i="";i=e.descriptionRefs?e.descriptionRefs.arr[e.descriptionRefs.idx].toLowerCase():t.NOME,data.img[document.getElementById("selectListToEdit").value][i]?data.img[document.getElementById("selectListToEdit").value][i]!=document.getElementById("newImgPreview").src&&(data.img[document.getElementById("selectListToEdit").value][i]=document.getElementById("newImgPreview").src,n=!0):(data.img[document.getElementById("selectListToEdit").value][i]=document.getElementById("newImgPreview").src,n=!0)}return n}function itemFilters(){let e=document.createElement("div");e.className="filterList";let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div"),d=document.createElement("div"),c={categoria:[""],rarita:[""],raggio:[""],mani:[""],tipo_danno:[""]};data.items.forEach(function(e){e.CATEGORIA&&(c.categoria.includes(e.CATEGORIA)||c.categoria.push(e.CATEGORIA)),e.RARITA&&(c.rarita.includes(e.RARITA)||c.rarita.push(e.RARITA)),e.RAGGIO&&(c.raggio.includes(e.RAGGIO)||c.raggio.push(e.RAGGIO)),e.MANI&&(c.mani.includes(e.MANI)||c.mani.push(e.MANI)),e.TIPO_DANNO&&(c.tipo_danno.includes(e.TIPO_DANNO)||c.tipo_danno.push(e.TIPO_DANNO))}),t.innerHTML="<span style='margin-right:1em;'>Nome</span>";let r=document.createElement("input");r.id="itemFilterName",r.type="text",r.addEventListener("keyup",applyItemFilter),t.appendChild(r),n.innerHTML="<span style='margin-right:1em;'>Categoria</span>";let s=document.createElement("select");s.id="itemFilterCategory",c.categoria.forEach(function(e){let t=document.createElement("option");t.value=e,t.text=e,s.appendChild(t)}),s.addEventListener("change",applyItemFilter),n.appendChild(s),i.innerHTML="<span style='margin-right:1em;'>Rarit&#224;</span>";let u=document.createElement("select");u.id="itemFilterRarity",c.rarita.forEach(function(e){let t=document.createElement("option");t.value=e,t.text=e,u.appendChild(t)}),u.addEventListener("change",applyItemFilter),i.appendChild(u),a.innerHTML="<span style='margin-right:1em;'>Raggio</span>";let m=document.createElement("select");m.id="itemFilterRange",c.raggio.forEach(function(e){let t=document.createElement("option");t.value=e,t.text=e,m.appendChild(t)}),m.addEventListener("change",applyItemFilter),a.appendChild(m),l.innerHTML="<span style='margin-right:1em;'>Marziale</span>";let p=document.createElement("input");p.id="itemFilterMartial",p.type="checkbox",p.addEventListener("change",applyItemFilter),l.appendChild(p),o.innerHTML="<span style='margin-right:1em;'>Mani Richieste</span>";let I=document.createElement("select");I.id="itemFilterHands",c.mani.forEach(function(e){let t=document.createElement("option");t.value=e,t.text=e,I.appendChild(t)}),I.addEventListener("change",applyItemFilter),o.appendChild(I),d.innerHTML="<span style='margin-right:1em;'>Tipo di Danno</span>";let E=document.createElement("select");E.id="itemFilterDmgType",c.tipo_danno.forEach(function(e){let t=document.createElement("option");t.value=e,t.text=e,E.appendChild(t)}),E.addEventListener("change",applyItemFilter),d.appendChild(E),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(a),e.appendChild(l),e.appendChild(o),e.appendChild(d);let g=document.getElementById("availableItems");if(g.firstChild){let t=g.firstChild;g.insertBefore(e,t),g.removeChild(t)}else g.appendChild(e)}function applyItemFilter(e){let t=document.getElementById("availableItems").querySelectorAll("[nome]"),n={};n.nome=document.getElementById("itemFilterName").value,n.categoria=document.getElementById("itemFilterCategory").value,n.rarita=document.getElementById("itemFilterRarity").value,n.raggio=document.getElementById("itemFilterRange").value,n.marziale=document.getElementById("itemFilterMartial").checked,n.mani=document.getElementById("itemFilterHands").value,n.tipo_danno=document.getElementById("itemFilterDmgType").value;for(let e of t){let t=1;Object.keys(n).forEach(function(i){let a=null,l=n[i];a=e.getAttribute(i)?e.getAttribute(i).toLowerCase():"","string"==typeof l?a.indexOf(l.toLowerCase())>=0?t*=1:t*=0:"boolean"==typeof l&&(t*=l?a==(l?"m":"")?1:0:1)}),1==t?e.classList.contains("hidden")&&e.classList.remove("hidden"):e.classList.add("hidden")}let i=document.getElementById("availableItems").querySelectorAll("[categoryWrapper='item']");for(let e=0;e<i.length;e++)i[e].querySelectorAll(".hidden[nome]").length==i[e].querySelectorAll("[nome]").length?i[e].classList.add("hidden"):i[e].classList.contains("hidden")&&i[e].classList.remove("hidden")}function setupClock(e={}){let t=e;null==t.description&&(t.description=""!=document.getElementById("clockDescription").value.trim()?document.getElementById("clockDescription").value.trim():null);let n=createNewClock(t);if(t.editable||null==t.editable){let e=fetchSvgIcon("times");e.style.position="absolute",e.style.top="0",e.style.right="0",e.addEventListener("click",()=>{clockList.splice(clockList.indexOf(n),1),updateClocks()}),n.appendChild(e)}return clockList.push(n),document.getElementById("clockDescription").value="",updateClocks(),n}function updateClocks(){document.getElementById("clockList").innerHTML="";for(let e=0;e<clockList.length;e++)document.getElementById("clockList").appendChild(clockList[e]);shareClocks()}function getClockParamList(){let e=[];for(let t=0;t<clockList.length;t++){let n={};null!=typeof clockList[t].clock.value&&(n.value=clockList[t].clock.value),null!=typeof clockList[t].clock.max&&(n.max=clockList[t].clock.max),null!=typeof clockList[t].clock.color&&(n.color=clockList[t].clock.color),null!=typeof clockList[t].clock.description&&(n.description=clockList[t].clock.description),null!=typeof clockList[t].clock.size&&(n.size=clockList[t].clock.size),n.editable=!1,e.push(n)}return e}function clockPattern(e,t=150){let n=t/1.5,i="M "+n+" "+n,a=2*Math.PI/e;for(let t=0;t<e;t++)i+=" L "+(Math.round(1e3*Math.cos(a*t))/1e3*n+n)+" "+(Math.round(1e3*Math.sin(a*t))/1e3*n+n)+" L "+n+" "+n;let l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.classList.add("clockGrid"),l.style.height=2*n+"px",l.style.width=2*n+"px",l.setAttribute("viewbox","0 0 "+2*n+" "+2*n),l.setAttribute("xmlns","http://www.w3.org/2000/svg");let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("stroke","black"),o.setAttribute("stroke-width","1"),o.setAttribute("d",i),l.appendChild(o),l}function createNewClock(e={},t=null){let n=document.createElement("div");n.value=null==e.value?"0":e.value,n.max=null==e.max?"4":e.max,n.color=null==e.color?"orange":e.color,n.description=e.description,n.size=null==e.size?150:Number(e.size.toString().match(/\d+/g)),n.editable=null==e.editable||e.editable,n.setValue=null==e.setValue||e.setValue,n.setMax=null==e.setMax||e.setMax,n.className="clock",n.style.cssText="--p:"+n.value+";--s:"+n.max+";--c:"+n.color+";--w:"+n.size+"px;";let i=clockPattern(n.max,n.size);n.prepend(i),n.grid=i;let a=document.createElement("span");n.appendChild(a),n.label=a;let l=document.createElement("div");l.className="clockWrapper",l.appendChild(n),l.clock=n;let o=document.createElement("div");o.setAttribute("controls",!0),n.editable&&l.appendChild(o);let d=document.createElement("input"),c=document.createElement("input");d.type="number",c.type="number",d.min="0",c.min="4",d.max=n.max,c.max="12",d.value=n.value,c.value=n.max,d.addEventListener("change",()=>{""==d.value&&(d.value=0),n.updateClock(d.value)}),c.addEventListener("change",()=>{""==c.value&&(c.value=0),d.max=c.value,Number(d.value)>Number(c.value)&&(d.value=c.value,d.max=c.value),n.updateClock(d.value,c.value)});let r=document.createElement("span"),s=document.createElement("span");r.innerHTML="Avanzamento",s.innerHTML="Nr. sezioni";let u=document.createElement("div"),m=document.createElement("div"),p=fetchSvgIcon("minus"),I=fetchSvgIcon("plus"),E=p.cloneNode(!0),g=I.cloneNode(!0),f=document.createEvent("HTMLEvents");if(f.initEvent("change",!1,!0),p.addEventListener("click",()=>{d.value=Math.max(Number(d.min),Number(d.value)-1),d.dispatchEvent(f)}),I.addEventListener("click",()=>{d.value=Math.min(Number(d.max),Number(d.value)+1),d.dispatchEvent(f)}),E.addEventListener("click",()=>{c.value=Math.max(Number(c.min),Number(c.value)-1),c.dispatchEvent(f)}),g.addEventListener("click",()=>{c.value=Math.min(Number(c.max),Number(c.value)+1),c.dispatchEvent(f)}),n.setValue&&(o.appendChild(r),u.appendChild(p),u.appendChild(d),u.appendChild(I),o.appendChild(u)),n.setMax&&(o.appendChild(s),m.appendChild(E),m.appendChild(c),m.appendChild(g),o.appendChild(m)),n.valueInput=d,n.maxInput=c,null!=n.description){let e=document.createElement("div");e.innerHTML=n.description,e.setAttribute("description",!0),l.appendChild(e)}return n.editCssString=function(e,t){let i=n.style.cssText.replace(/ /gi,"").split(";");i[i.indexOf(i.find(e=>e.substr(0,3)===t))]=t+":"+e,n.style.cssText=i.join(";")},n.setclockValue=function(e=null,t=null){null!=t&&n.setMaxSlice(t);let i=null==e?Math.min(Number(n.value),Number(n.max)):e;n.editCssString(i,"--p"),n.value=i,a.innerHTML=i+"/"+n.max,n.checkMax()},n.setMaxSlice=function(e){if(null!==e){n.editCssString(e,"--s"),n.max=e;let t=clockPattern(n.max,n.size);n.removeChild(n.grid),n.prepend(t),n.grid=t,n.checkMax()}},n.checkMax=function(){Number(n.value)>=Number(n.max)?n.classList.add("clockFull"):n.classList.remove("clockFull")},n.updateClock=function(e=null,i=null){n.setclockValue(e,i),shareClocks(),null!=t&&t(n)},n.updateClock(),l}function zeroPowerClock(){return createNewClock({max:"6",description:null,value:characterInfo.zeroPowerProgress,setMax:!1},e=>{characterInfo.zeroPowerProgress=e.value})}function createTracker(e,t=!0,n=null){const i={fabula:{tag:"Punti Fabula",icon_id:"book",icon_class:"falt",icon_src:"book-open",icon_fn:null},hp:{tag:"Punti Vita",icon_id:"heart",icon_class:"falt",icon_src:"heartbeat",icon_fn:e=>heal()},mp:{tag:"Punti Mente",icon_id:"mind",icon_class:"falt",icon_src:"brain",icon_fn:e=>refresh()},ip:{tag:"Punti Inventario",icon_id:"ipIcon",icon_class:"falt",icon_src:"briefcase",icon_fn:null},clock:{tag:"Orologio",icon_id:"",icon_class:"falt",icon_src:"clock",icon_fn:null}};if(i[e]){let l=document.createElement("div");l.className="scoreTracker";let o=document.createElement("div");o.innerHTML=i[e].tag,l.appendChild(o);let d=document.createElement("div");d.style.display="flex",d.style.fontSize="2rem",d.style.lineHeight="100%";let c=fetchSvgIcon(i[e].icon_src);function a(e,t){"none"==t.style.display?(t.style.removeProperty("display"),e.style.display="none"):(t.style.display="none",e.style.removeProperty("display"))}c.id=i[e].icon_id,c.style.margin="auto",c.className=i[e].icon_class,c.addEventListener("click",i[e].icon_fn),d.appendChild(c);let r=document.createElement("div");r.id="tracker_"+e,r.style.margin="auto",r.crossRef=e,d.appendChild(r);let s=document.createElement("input");s.type="Number",s.min=0,s.id=e,s.style.display="none",d.appendChild(s);let u=null;void 0!==characterInfo[e]?u=characterInfo[e]:null!=n&&(u=n),l.viewer=r,l.input=s,l.refObj=u,r.innerHTML=u.current;let m=null,p=null;t&&(r.addEventListener("dblclick",()=>{a(r,s)}),s.value=l.refObj.current,s.addEventListener("change",e=>{refreshTracker(l,s.value)}),s.addEventListener("keydown",e=>{"Enter"!=e.code&&"NumpadEnter"!=e.code&&"Tab"!=e.code&&13!==e.keyCode||document.activeElement.blur()}),s.addEventListener("blur",()=>{a(r,s)}),s.addEventListener("dblclick",()=>{a(r,s)}),(p=document.createElement("div")).style.fontSize="1rem",p.style.cursor="pointer",p.style.userSelect="none",p.innerHTML="<",p.score=e,p.addEventListener("click",function(e){refreshTracker(l,l.refObj.current-1)}),p.addEventListener("mousedown",async function(e){for(keptPressed=!0,await sleep(500);keptPressed&&(refreshTracker(l,l.refObj.current-1),l.input.value!=Math.max(l.input.min,Number(l.input.value)-1));)await sleep(50)}),p.addEventListener("mouseup",function(e){keptPressed=!1}),p.addEventListener("contextmenu",e=>e.preventDefault()),p.setAttribute("preventContext",!0),d.prepend(p),(m=document.createElement("div")).style.fontSize="1rem",m.style.cursor="pointer",m.style.userSelect="none",m.innerHTML=">",m.score=e,m.addEventListener("click",function(e){refreshTracker(l,l.refObj.current+1)}),m.addEventListener("mousedown",async function(e){for(keptPressed=!0,await sleep(500);keptPressed&&(refreshTracker(l,l.refObj.current+1),l.input.value!=Math.min(l.input.max?l.input.max:1/0,Number(l.input.value)+1));)await sleep(50)}),m.addEventListener("mouseup",function(e){keptPressed=!1}),m.addEventListener("contextmenu",e=>e.preventDefault()),m.setAttribute("preventContext",!0),d.appendChild(m)),l.appendChild(d);let I=document.createElement("div");return I.style.fontSize="1rem",l.refObj.max&&(I.innerHTML="Max: "+(Number(l.refObj.max)+Number(l.refObj.mod)),t&&(s.max=Number(l.refObj.max)+Number(l.refObj.mod),I.title="Fai doppio click per cambiare il modificatore",I.style.cursor="pointer",I.style.display="flex",I.style.alignItems="center",I.style.justifyContent="center",I.addEventListener("dblclick",function(e){addMod(e.target,l.refObj)}))),l.appendChild(I),l.textForChat={get value(){let t="\n**"+i[e].tag+"**",n={};return n.target=document.getElementById(e),t+="\nValore attuale: "+n.target.value+(n.target.max?"/"+n.target.max:"")}},l.addEventListener("contextmenu",function(e){buildContextMenu(l,[e.clientX,e.clientY],{chatInter:!0}),e.preventDefault(e)}),l}return null}async function saveCharacter(e=!1){FUDB.chars.get(characterInfo.name,function(t){let n=!1;(n=!!e||window.confirm("Salvando si sovrascriveranno i dati gia' presenti: continuare?"))&&FUDB.chars.update({id:characterInfo.name,data:JSON.stringify(characterInfo)})},function(){FUDB.chars.add({id:characterInfo.name,data:JSON.stringify(characterInfo)}),updateListFromDB(document.getElementById("listOfChars"),"chars")})}async function loadCharacter(e){Object.keys(characterInfo).forEach(function(t){e.hasOwnProperty(t)&&(characterInfo[t]=e[t])}),void 0!==characterInfo.autosave&&(document.getElementById("autosaveFlag").checked=characterInfo.autosave),updateSheet()}async function deleteCharacter(){if(window.confirm("La cancellazione � irreversibile: continuare?")){let e=document.getElementById("listOfChars");if(e.value){let t=e.selectedIndex;FUDB.chars.delete(e.value,function(){e.remove(t)})}else console.log("Nessun nome di personaggio da eliminare.")}}async function download(){let e=new Blob([JSON.stringify(characterInfo)],{type:"text/plain"});if(console.log(JSON.stringify(characterInfo)),"undefined"!=typeof Capacitor&&void 0!==Capacitor.Plugins.Filesystem)return;let t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=characterInfo.name+".fabula",t.click()}function sanitizeString(e){return e.replace("<script","").replace("</script","").replace("<a","").replace("</a","").replace("onclick=","").replace("href=","")}async function fetchCharFromMemory(){let e=document.getElementById("listOfChars");e.value?FUDB.chars.get(e.value,function(e){console.log("Caricamento in corso...");let t=sanitizeString(e.data);loadCharacter(JSON.parse(t)),console.log("Caricamento completato.")},function(){console.log("Nessun personaggio da caricare.")}):console.log("Nessun nome di personaggio da caricare.")}function upload(){if(this.files&&this.files[0]){var e=this.files[0],t=new FileReader;t.addEventListener("load",function(e){let t=sanitizeString(e.target.result);loadCharacter(JSON.parse(t)),document.getElementById("charLoader").value=""}),t.readAsText(e)}}async function saveDefaultLibrary(){if(document.getElementById("listOfLibraries").value){let e=document.getElementById("listOfLibraries").value;FUDB.chosenSet.get("default",function(t){FUDB.chosenSet.update({id:"default",data:e}),alert("Libreria "+e+" impostata come default."),console.log("Libreria preferita modificata.")},function(){FUDB.chosenSet.add({id:"default",data:e}),alert("Libreria "+e+" impostata come default."),console.log("Libreria preferita definita.")})}}async function loadDefaultLibrary(){FUDB.chosenSet.get("default",function(e){document.getElementById("listOfLibraries").value=e.data,fetchLibraryFromMemory(e.data)},function(){console.log("Nessuna libreria preferita definita.")})}function saveLibraryPrompt(){data.id=window.prompt("Indicare il nome della libreria da archiviare.",data.id),saveLibrary()}async function saveLibrary(){data.hasOwnProperty("id")&&FUDB.libraries.get(data.id,function(e){window.confirm("Salvando si sovrascriveranno i dati gia' presenti: continuare?")&&(FUDB.libraries.update({id:data.id,data:JSON.stringify(data)}),setLibraryToBeSaved(!1))},function(){FUDB.libraries.add({id:data.id,data:JSON.stringify(data)}),updateListFromDB(document.getElementById("listOfLibraries"),"libraries"),setLibraryToBeSaved(!1)})}async function loadLibrary(e){data=e,addChatLine("Info","Libreria "+e.id+" caricata."),document.getElementById("curLibraryName").innerHTML="Libreria corrente: <b>"+e.id+"</b>",updateSheet()}async function deleteLibrary(){if(window.confirm("La cancellazione � irreversibile: continuare?")){let e=document.getElementById("listOfLibraries");if(e.value){let t=e.selectedIndex;FUDB.libraries.delete(e.value,function(){let n=data.id;FUDB.chosenSet.get("default",function(e){n==e.data&&FUDB.libraries.delete("default",function(){console.log("Rimossa libreria di default.")})},function(){}),n==e.value&&(data=defaultData,updateSheet()),e.remove(t)})}else console.log("Nessuna libreria da eliminare.")}}function downloadLibrary(){var e=document.createElement("a"),t=new Blob([JSON.stringify(data)],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download=data.id+".fudb",e.click()}async function fetchLibraryFromMemory(e=null){e||(e=document.getElementById("listOfLibraries").value),null!=e?FUDB.libraries.get(e,function(e){console.log("Caricamento in corso..."),loadLibrary(JSON.parse(e.data)),itemFilters(),console.log("Caricamento completato."),populateEditorSelect(),"Annulla"==document.getElementById("confirmObjectToEdit").innerHTML&&document.getElementById("confirmObjectToEdit").click(),(characterInfo.inventory.length>0||characterInfo.skills.length>0)&&window.confirm("Rilevato un personaggio in memoria: si vuole verificare se ci sono aggiornamenti da eseguire?")&&checkCharacterUpdate()},function(){console.log("Nessuna libreria da caricare.")}):console.log("Nessuna libreria da caricare.")}function checkCharacterUpdate(){let e=null;for(let t=0;t<characterInfo.inventory.length;t++){let n=characterInfo.inventory[t];(e=data.items.filter(e=>e.NOME===n.NOME)).length>0&&Object.keys(n).forEach(t=>{n[t]!==e[0][t]&&void 0!==n[t]&&void 0!==e[0][t]&&"object"!=typeof n[t]&&"object"!=typeof e[0][t]&&window.confirm("Trovata differenza in oggetto '"+e[0].NOME+"', proprietà '"+t+"': valore attuale '"+n[t]+"', valore nuovo '"+e[0][t]+"'. Sostituire?")&&(n[t]=e[0][t])})}for(let t=0;t<characterInfo.skills.length;t++){let n=characterInfo.skills[t];(e=data.abilities.filter(e=>e.NOME===n.NOME)).length>0&&Object.keys(n).forEach(t=>{n[t]!==e[0][t]&&void 0!==n[t]&&void 0!==e[0][t]&&"object"!=typeof n[t]&&"object"!=typeof e[0][t]&&window.confirm("Trovata differenza in oggetto '"+e[0].NOME+"', proprietà '"+t+"': valore attuale '"+n[t]+"', valore nuovo '"+e[0][t]+"'. Sostituire?")&&(n[t]=e[0][t])})}updateSheet()}function uploadLibrary(){if(this.files&&this.files[0]){var e=this.files[0],t=new FileReader;t.addEventListener("load",function(e){data=JSON.parse(e.target.result),saveLibrary(),updateSheet(),document.getElementById("libraryLoader").value=""}),t.readAsText(e)}}function loadMod(){if(this.files&&this.files[0]){var e=this.files[0],t=new FileReader;t.addEventListener("load",function(e){let t=null;void 0!==document.getElementById("importedLib")&&null!=document.getElementById("importedLib")?t=document.getElementById("importedLib"):((t=document.createElement("script")).id="importedLib",document.getElementsByTagName("head")[0].appendChild(t)),t.innerHTML=e.target.result}),t.readAsText(e)}}function sleep(e){return new Promise(t=>setTimeout(t,e))}function encodeImage(e,t){var n=e.files[0],i=new FileReader;i.onloadend=function(){t(i.result)},i.readAsDataURL(n)}function refreshProfileImage(){if(characterInfo.hasOwnProperty("img")&&""!=characterInfo.img){let e=document.createElement("img");e.style.margin="0.5em",e.style.maxHeight="25em",e.style.maxWidth="var(-webkit-fill-available, -moz-available)",e.src=characterInfo.img,document.getElementById("profileImage").innerHTML="";let t=document.createElement("div"),n=fetchSvgIcon("times");n.style.width="3em",n.style.height="3em",t.appendChild(n),t.addEventListener("click",function(){characterInfo.img="",document.getElementById("profileImage").innerHTML=""}),t.className="popupMenu",e.textForChat={get value(){return e.outerHTML}},e.addEventListener("contextmenu",function(t){buildContextMenu(e,[t.clientX,t.clientY],{chatInter:!0}),t.preventDefault(t)}),document.getElementById("profileImage").appendChild(t),document.getElementById("profileImage").appendChild(e)}else document.getElementById("profileImage").innerHTML=""}function editPalette(e=characterInfo.sheetColor){let t=pSBC(0,e,"c"),n=pSBC(.5,e,"c"),i=pSBC(-.5,e,"c"),a=pSBC(-.9,e,"c"),l=null;(l=document.getElementById("FUSpecificStyle").sheet.cssRules)&&(l[0].style.backgroundColor=n,l[0].style.color=getBrightness(n)>125?"black":"white",l[1].style.backgroundColor=t,l[1].style.color=getBrightness(t)>125?"black":"white",l[2].style.backgroundColor=i,l[2].style.color=getBrightness(i)>125?"black":"white",l[3].style.borderColor=a,l[4].style.filter=getBrightness(n)>125?"brightness(0) saturate(100%)":"invert(100%)",l[5].style.filter=getBrightness(t)>125?"brightness(0) saturate(100%)":"invert(100%)",l[6].style.filter=getBrightness(i)>125?"brightness(0) saturate(100%)":"invert(100%)")}function getBrightness(e){let t=e.split("(")[1].split(")")[0].split(",");return Math.round((299*t[0]+587*t[1]+114*t[2])/1e3)}const pSBC=(e,t,n,i)=>{let a,l,o,d,c,r,s,u=parseInt,m=Math.round,p="string"==typeof n;return"number"!=typeof e||e<-1||e>1||"string"!=typeof t||"r"!=t[0]&&"#"!=t[0]||n&&!p?null:(this.pSBCr||(this.pSBCr=(e=>{let t=e.length,n={};if(t>9){if([a,l,o,p]=e=e.split(","),(t=e.length)<3||t>4)return null;n.r=u("a"==a[3]?a.slice(5):a.slice(4)),n.g=u(l),n.b=u(o),n.a=p?parseFloat(p):-1}else{if(8==t||6==t||t<4)return null;t<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?e[4]+e[4]:"")),e=u(e.slice(1),16),9==t||5==t?(n.r=e>>24&255,n.g=e>>16&255,n.b=e>>8&255,n.a=m((255&e)/.255)/1e3):(n.r=e>>16,n.g=e>>8&255,n.b=255&e,n.a=-1)}return n})),s=t.length>9,s=p?n.length>9||"c"==n&&!s:s,c=this.pSBCr(t),d=e<0,r=n&&"c"!=n?this.pSBCr(n):d?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},d=1-(e=d?-1*e:e),c&&r?(i?(a=m(d*c.r+e*r.r),l=m(d*c.g+e*r.g),o=m(d*c.b+e*r.b)):(a=m((d*c.r**2+e*r.r**2)**.5),l=m((d*c.g**2+e*r.g**2)**.5),o=m((d*c.b**2+e*r.b**2)**.5)),p=c.a,r=r.a,p=(c=p>=0||r>=0)?p<0?r:r<0?p:p*d+r*e:0,s?"rgb"+(c?"a(":"(")+a+","+l+","+o+(c?","+m(1e3*p)/1e3:"")+")":"#"+(4294967296+16777216*a+65536*l+256*o+(c?m(255*p):0)).toString(16).slice(1,c?void 0:-2)):null)};function encodeHTML(e){return e.replace(/[\u00A0-\u9999\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"})}function getElementByFUId(e){return document.querySelectorAll("[fuid='"+e+"']")[0]}function fetchMemoryData(){let e=document.getElementById("listOfChars"),t=document.getElementById("listOfLibraries");updateListFromDB(e,"chars"),updateListFromDB(t,"libraries")}function updateListFromDB(e,t){FUDB[t].keys(function(t){populateSelect(e,t)})}function populateSelect(e,t){t.length>0&&(e.innerHTML="",t.forEach(function(t,n){let i=document.createElement("option");void 0!==t.NOME?(i.refObj=t,i.value=t.NOME,i.text=t.NOME):(i.value=t,i.text=t),e.appendChild(i)}))}function populateEditorSelect(){if(!data[document.getElementById("selectListToEdit").value]){if(!data.editorTags[document.getElementById("selectListToEdit").value.toUpperCase()])return!1;{let e={};Object.keys(data.editorTags[document.getElementById("selectListToEdit").value.toUpperCase()]).forEach(t=>{e[t]="NOME"===t?"Nuovo...":""}),data[document.getElementById("selectListToEdit").value]=[e]}}data[document.getElementById("selectListToEdit").value].length>0&&(document.getElementById("listToEdit").innerHTML="",data[document.getElementById("selectListToEdit").value].forEach(function(e,t){let n=document.createElement("option");void 0!==e.NOME?(n.value=e.NOME,n.text=e.NOME,n.refObj=e):(n.value=e,n.text=e,n.refObj={arr:data[document.getElementById("selectListToEdit").value],idx:t,NOME:e.toLowerCase()}),document.getElementById("listToEdit").appendChild(n)}))}function setLibraryToBeSaved(e){e?(document.getElementById("curLibraryName").innerHTML="Libreria corrente: <b style='color:red;'>"+data.id+" - ci sono modifiche non salvate</b>",document.getElementById("saveLib").style.removeProperty("display")):(document.getElementById("curLibraryName").innerHTML="Libreria corrente: <b>"+data.id+"</b>",document.getElementById("saveLib").style.display="none")}function selectToolkitMode(e){let t=document.getElementById("FUToolkit").querySelectorAll("[modeSelector]");"charSheet"==e?(document.getElementById("selectCharacterMode").setAttribute("selected","true"),document.getElementById("selectLibraryMode").removeAttribute("selected"),document.getElementById("selectBestiaryMode").removeAttribute("selected")):"library"==e?(document.getElementById("selectCharacterMode").removeAttribute("selected"),document.getElementById("selectLibraryMode").setAttribute("selected","true"),document.getElementById("selectBestiaryMode").removeAttribute("selected")):"bestiary"==e&&(document.getElementById("selectCharacterMode").removeAttribute("selected"),document.getElementById("selectLibraryMode").removeAttribute("selected"),document.getElementById("selectBestiaryMode").setAttribute("selected","true"));for(let n=0;n<t.length;n++){let i=!1;t[n].getAttribute("modeSelector")==e&&(i=!0),i?t[n].style.removeProperty("display"):t[n].style.display="none"}}function progressiveNaming(e,t){let n=0,i="",a="";return e.endsWith(")")&&e.lastIndexOf("(")>-1&&(i=e.substring(e.lastIndexOf("(")),n=Number(i.substring(1,i.length-1))),a=""==i?e+" ("+(n+1)+")":e.replace(i,"("+(n+1)+")"),t.includes(a)&&(a=progressiveNaming(a,t)),a}function showLobby(e){"join"==e?(document.getElementById("lobbyCreator").disabled=!1,document.getElementById("lobbyUser").disabled=!0,document.getElementById("lobbyJoin").style.removeProperty("display"),document.getElementById("lobbyMake").style.display="none"):"make"==e&&(document.getElementById("lobbyCreator").disabled=!0,document.getElementById("lobbyUser").disabled=!1,document.getElementById("lobbyMake").style.removeProperty("display"),document.getElementById("lobbyJoin").style.display="none")}function disableLobbySelector(){let e=document.getElementById("lobbyCreator"),t=document.getElementById("lobbyUser"),n=document.getElementById("lobbyName"),i=document.getElementById("userName"),a=document.getElementById("connect"),l=document.getElementById("disconnect"),o=document.getElementById("startLobby"),d=document.getElementById("idLobby");null!=p2p.peer?(e.disabled=!0,t.disabled=!0,n.disabled=!0,i.disabled=!0,a.disabled=!0,l.disabled=!1,o.disabled=!0,d.disabled=!0,document.getElementById("charSharer").style.removeProperty("display"),document.getElementById("libSharer").style.removeProperty("display")):(e.disabled=!1,t.disabled=!1,n.disabled=!1,i.disabled=!1,a.disabled=!1,l.disabled=!0,o.disabled=!1,d.disabled=!1,document.getElementById("charSharer").style.display="none",document.getElementById("libSharer").style.display="none",document.getElementById("usListChar").innerHTML="",document.getElementById("usListLib").innerHTML="")}function sendMessage(e=null,t=null){let n="";""!=(n=null===e?document.getElementById("msgToSend").value.trim():e.toString())&&(null==p2p.peer?addChatLine("I",n):broadcastMessage(n)),document.getElementById("msgToSend").value="",document.getElementById("msgToSend").focus()}function addChatLine(e,t){if(""!=t){let n=document.createElement("span");if(n.innerHTML="<b>"+e+"</b>: "+t.toString(),n.className="chatLine",document.getElementById("chatLog").appendChild(n),document.getElementById("chatLog").scrollTo(0,document.getElementById("chatLog").scrollHeight),"string"==typeof t||t instanceof String){if("/r "===t.substring(0,3).toLowerCase()&&(null==p2p.peer||null!=p2p.peer&&p2p.master)){let n=rollEngine(e,t),i=n.listOfRolls,a=document.createElement("span");a.className="chatLine";let l=a.cloneNode(!0),o=a.cloneNode(!0),d=a.cloneNode(!0);if(l.innerHTML=i,o.innerHTML="Rolled a "+n.total+"!",2==n.rolls.filter(e=>null!=e.max).length&&2==n.rolls.filter(e=>e.value==n.rolls.reduce((e,t)=>e+t.value,0)/2).length){let t="";2==n.rolls.filter(e=>e.value>=6).length?t="<span style='color:green;'>["+e+"] Critico!</span>":2==n.rolls.filter(e=>1==e.value).length?t="<span style='color:red;'>["+e+"] Fallimento critico!</span>":hasAbility(characterInfo,"FRENESIA")&&(t="<span style='color:lime;'>["+e+"] Critico (Frenesia)!</span>"),broadcastMessage(t,"RollEngine"),d.innerHTML=t}waitForCallback>0&&(document.getElementById("rollResult").appendChild(l),document.getElementById("rollResult").appendChild(o),document.getElementById("rollResult").appendChild(d),waitForCallback=0)}waitForCallback>0&&n.innerHTML.search(">"+p2p.userName+"<")>-1&&"RollEngine"==e&&(document.getElementById("rollResult").appendChild(n.cloneNode(!0)),waitForCallback--)}return"none"==document.getElementById("FUChat").style.display&&document.getElementById("openChat").classList.add("chatNotification"),n}return null}function randomInt(e){return Math.floor(Math.random()*e)+1}function rollEngine(e,t){let n=rollDice(t);n.listOfRolls="";for(let e=0;e<n.rolls.length;e++)""!=n.listOfRolls&&(n.rolls[e].positive?n.listOfRolls+=" + ":n.listOfRolls+=" - "),n.listOfRolls+=n.rolls[e].value+(n.rolls[e].max?"(d"+n.rolls[e].max+")":"");return broadcastMessage("["+e+"] "+n.listOfRolls,"RollEngine"),broadcastMessage("["+e+"]  rolled a "+n.total+"!","RollEngine"),n}function rollDice(e){let t={rolls:[],total:0},n=e.substring(3).trim().replace(/  |\t\r\n|\n|\r/gm,"").toLowerCase(),i=!1,a="0",l="",o={value:0,positive:!0,max:null},d=!0;for(let e=0;e<n.length;e++){let c=n.charAt(e);if(isNaN(parseInt(c))||(i?l=l.concat(c):a=a.concat(c)),"d"===c&&(i=!0),"+"===c||"-"===c||e==n.length-1){let n=null,r=1;if(i&&(r=Math.max(1,parseInt(a))),e>0){for(let e=0;e<r;e++)n=JSON.parse(JSON.stringify(o)),i?(n.value=randomInt(parseInt(l)),n.positive=!0,n.max=parseInt(l)):(n.value=parseInt(a),n.positive=d),n.positive?t.total+=n.value:t.total-=n.value,t.rolls.push(n);a="0",l="",i=!1}"+"===c?d=!0:"-"===c&&(d=!1)}}return t}function showMonster(e,t){let n=document.createElement("div");n.className="monsterStats";let i="",a="",l=document.createElement("div");if(t.includes("head")){""!=e.IMG&&((a=document.createElement("img")).style.border="2px solid black",a.style.display="block",a.style.maxWidth="10em",a.style.width="auto",a.style.height="auto",a.style.position="relative",a.style.float="left",a.style.margin="2em",a.src=e.IMG,l.appendChild(a));let t=document.createElement("div");t.className="monsterStatRow",t.innerHTML="<b>"+e.NOME.toUpperCase()+" ? Liv "+e.LIVELLO+" ? "+e.TIPO.toUpperCase()+"</b>",l.appendChild(t)}if(t.includes("desc")){let n=document.createElement("div");n.className="monsterStatRow",n.innerHTML=e.DESCRIZIONE;let i=createTextInput(function(n){""!=i[0].value.trim()&&(e.DESCRIZIONE=i[0].value,i[0].removeAttribute("newInput"),document.getElementById("bestiaryEditor").innerHTML="",document.getElementById("bestiaryEditor").appendChild(showMonster(e,t)))},updateSheet);l.appendChild(n),l.appendChild(i[0]),l.appendChild(i[1])}if(t.includes("traits")){let t=document.createElement("div");t.className="monsterStatRow",t.innerHTML="<b>Tratti tipici: </b>"+e.TRATTI,t.style.justifyContent="center",l.appendChild(t)}if(n.appendChild(l),t.includes("stats")){let t=document.createElement("div");t.className="monsterStatRow";let i=document.createElement("div");i.style.border="1px black",i.style.borderStyle="none solid",i.className="monsterStatRow",traits.style.borderBottom="0px";let a=document.createElement("div");a.innerHTML="<b>DES d"+e.DES+"</b>",i.appendChild(a);let l=document.createElement("div");l.innerHTML="<b>INT d"+e.INT+"</b>",i.appendChild(l);let o=document.createElement("div");o.innerHTML="<b>VIG d"+e.VIG+"</b>",i.appendChild(o);let d=document.createElement("div");d.innerHTML="<b>VOL d"+e.VOL+"</b>",i.appendChild(d);let c=document.createElement("div");c.style.border="1px black",c.style.borderStyle="none solid",c.style.backgroundColor="red",c.innerHTML="<b>PV: "+e.PV+" ? "+Math.floor(e.PV/2)+"</b>";let r=document.createElement("div");r.style.border="1px black",r.style.borderStyle="none solid",r.style.backgroundColor="deepskyblue",r.innerHTML="<b>PM: "+e.PM+"</b>";let s=document.createElement("div");s.style.border="1px black",s.style.borderStyle="none solid",s.innerHTML="<b>Iniz. "+e.INIZ+"</b>",t.appendChild(i),t.appendChild(c),t.appendChild(r),t.appendChild(s),n.appendChild(t)}if(t.includes("defs")||t.includes("defsShort")){let i=document.createElement("div");i.className="monsterStatRow";let a=document.createElement("div");a.style.border="1px black",a.style.borderStyle="none solid",a.innerHTML="<b>DIF "+e.DIF+"</b>",i.appendChild(a);let l=document.createElement("div");l.style.border="1px black",l.style.borderStyle="none solid",l.innerHTML="<b>D. MAG "+e.DMAG+"</b>",i.appendChild(l);let o=null;for(const n in e.ELEM)(t.includes("defs")||""!=e.ELEM[n])&&((o=document.createElement("div")).title=n,o.style.border="1px black",o.style.borderStyle="none solid",o.innerHTML=n.charAt(0).toUpperCase()+n.slice(1)+": "+(""==e.ELEM[n]?"-":e.ELEM[n]),i.appendChild(o));n.appendChild(i)}if(t.includes("atks")){let t=document.createElement("div");t.className="monsterStatRow",t.innerHTML="<h3>ATTACCHI BASE</h3>",n.appendChild(t),e.ATTACCHI.forEach(function(e,t){(i=document.createElement("div")).className="monsterStatRow",i.innerHTML="<span style='color: transparent;text-shadow: 0 0 0 black;font-weight: bold;margin: 5px;'>"+("M"==e.raggio?"⚔":"🏹")+"</span><b>"+e.nome+"</b> ? <b class='tp'>"+e.TP+"</b> ? <b>"+e.TD+"</b> danni "+e.tipo,n.appendChild(i)})}if(e.INCANTESIMI.length>0&&t.includes("spells")){let t=document.createElement("div");t.className="monsterStatRow",t.innerHTML="<h3>INCANTESIMI</h3>",n.appendChild(t),e.INCANTESIMI.forEach(function(e,t){(i=document.createElement("div")).innerHTML="<span style='color: transparent;text-shadow: 0 0 0 black;font-weight: bold;margin: 5px;'>⚝</span><b>"+e.nome+" "+("1"==e.offensivo?"⚡":"")+" ? <span class='tp'>"+e.TP+"</span> ? "+e.costo+" ? "+e.bersagli+" ? "+e.durata+"</b>",n.appendChild(i),(i=document.createElement("div")).innerHTML=e.descrizione,n.appendChild(i)})}if(e.AZIONI.length>0&&t.includes("actions")){let t=document.createElement("div");t.className="monsterStatRow",t.innerHTML="<h3>ALTRE AZIONI</h3>",n.appendChild(t),e.AZIONI.forEach(function(e,t){(i=document.createElement("div")).innerHTML="<b>"+("1"==e.azione?"<span style='color: transparent;text-shadow: 0 0 0 black;font-weight: bold;margin: 5px;'>⚙</span>":"")+" "+e.nome+"</b> ? "+e.descrizione,n.appendChild(i)})}if(e.REGOLE.length>0&&t.includes("rules")){let t=document.createElement("div");t.className="monsterStatRow",t.innerHTML="<h3>REGOLE SPECIALI</h3>",n.appendChild(t),e.REGOLE.forEach(function(e,t){(i=document.createElement("div")).innerHTML="<b>"+e.nome+"</b> ? "+e.descrizione,n.appendChild(i)})}return n}function setupEULA(){document.getElementById("EULA").style.removeProperty("display"),document.getElementById("startup").style.display="none",FUDB.open(()=>{FUDB.EULA.get("0",()=>{document.getElementById("EULA").style.display="none",startUp()},()=>{document.getElementById("EULA").firstElementChild.style.removeProperty("display")})})}function acceptEULA(){document.getElementById("EULA").style.display="none",FUDB.EULA.add({id:"0",data:"1"}),startUp()}function startUp(){loadDefaultLibrary(),fetchMemoryData(),document.querySelectorAll("link[rel='icon']")[0].setAttribute("href",fallbackImgB64),data=defaultData,startUpCharacter(),itemFilters(),setupEvents(),document.getElementById("openClocks").style.removeProperty("display"),document.getElementById("openLobby").style.removeProperty("display"),document.getElementById("openChat").style.removeProperty("display"),"undefined"!=typeof Capacitor&&(void 0!==Capacitor.Plugins.App&&(Capacitor.Plugins.App.addListener("backButton",function(){"none"!=document.getElementById("modalBckgr").style.display&&setModal()}),Capacitor.Plugins.App.addListener("appUrlOpen",e=>{const t=e.url.split(domain)[1];p2p.master||(document.getElementById("idLobby").value=t,joinLobby())})),void 0!==Capacitor.Plugins.Filesystem&&(document.getElementById("exportChar").style.display="none",document.getElementById("exportLib").style.display="none"))}